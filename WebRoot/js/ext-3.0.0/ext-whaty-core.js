Ext.ExtUtil=function(){this.timeout=30};Ext.ExtUtil.prototype={doInit:function(){window._OPT_IDS=[]},isEmpty:function(text){if(text==undefined||text==null||text==""||text=="null"||text=="undefined"){return true}else{text=text.replace(/(\s*$)/g,"");if(text==""){return true}}return false},doAjax:function(config){var _response=null;Ext.Ajax.request({params:config.params,url:config.url,async:false,method:"POST",success:function(response,opts){if(response.responseJSON==null||response.responseJSON==undefined){response.responseJSON=Ext.util.JSON.decode(response.responseText)}_response=response.responseJSON},failure:function(response,opts){Ext.Msg.alert("ajax request failure, please check url or try again...")}});if(_response==null){_response=new Object();_response.success=false;_response.logicSuccess=false}return _response},loadContainerPanel:function(param){var fwv=Ext.getCmp("WhatyFrameWorkViewport");if(fwv!=null&&fwv!=undefined){fwv.loadContainerPanel(param)}else{alert("WhatyFrameWorkViewport is not defined")}},refreshTabPanelById:function(id){var fwc=Ext.getCmp("FWContainerPanel");if(fwc!=null&&fwc!=undefined){fwc.refreshTabPanelById(id)}else{alert("FWContainerPanel is not defined")}},refreshCurrentTabPanel:function(){var fwc=Ext.getCmp("FWContainerPanel");if(fwc!=null&&fwc!=undefined){fwc.refreshCurrentTabPanel()}else{alert("FWContainerPanel is not defined")}},closeTabPanelById:function(id){var fwc=Ext.getCmp("FWContainerPanel");if(fwc!=null&&fwc!=undefined){fwc.closeTabPanelById(id)}else{alert("FWContainerPanel is not defined")}},closeCurrentTabPanel:function(){var fwc=Ext.getCmp("FWContainerPanel");if(fwc!=null&&fwc!=undefined){fwc.closeCurrentTabPanel()}else{alert("FWContainerPanel is not defined")}},getCurrentTabPanel:function(){var fwc=Ext.getCmp("FWContainerPanel");if(fwc!=null&&fwc!=undefined){return fwc.getCurrentTab()}else{alert("FWContainerPanel is not defined")}return null},getTabPanelById:function(tabId){var fwc=Ext.getCmp("FWContainerPanel");if(fwc!=null&&fwc!=undefined){return fwc.getCurrentTab(id)}else{alert("FWContainerPanel is not defined")}return null},getElementById:function(id){return document.getElementById(id)},alert:function(title,msg,timeout){var alertMsg=Ext.Msg.show({title:title,msg:msg});if(timeout==undefined||typeof timeout!="number"){timeout=1500}setTimeout(function(){alertMsg.hide()},timeout)},openWindow:function(url,param){var height=500;var width=800;var top=(window.screen.availHeight-30-height)/2;var left=(window.screen.availWidth-10-width)/2;var features="height="+height+",width="+width+",top="+top+",left="+left+",toolbar=no,menubar=no,resizable=yes,scrollbars=yes,location=no,status=no";window.open(url,"")},setFormItemReadOnly:function(cmp,readOnly){cmp.el.dom.readOnly=readOnly;if(readOnly){cmp.el.dom.style.background="#c0c0c0"}else{cmp.el.dom.style.background="white"}},setReadOnly:function(cmp,readOnly){this.setFormItemReadOnly(cmp,readOnly)},filterPriority:function(ids){if(Ext.isArray(ids)){if(ids.length>0){var rst=this.getPriority(ids);if(rst!=null){if(rst=="SuperAdmin"){for(var i=0;i<ids.length;i++){var id=ids[i];this._setCmpVisible(id,true)}}else{for(var i=0;i<ids.length;i++){var id=ids[i];this._setCmpVisible(id,rst[id])}}}else{for(var i=0;i<ids.length;i++){var id=ids[i];this._setCmpVisible(id,false)}}}}},_setCmpVisible:function(id,flag){if(id.indexOf("NO_PRI_")==-1){var cmp=Ext.getCmp(id);if(cmp!=null&&typeof cmp=="object"&&cmp.setVisible!=undefined){cmp.setVisible(flag)}}},getPriority:function(ids){var optIds="";if(Ext.isArray(ids)){optIds=ids.join(",")}else{if(Ext.isString(ids)){optIds=ids}}var _url=CONTEXT_PATH+"/services/system/OperationAction_isAccessedToOperations.action";var _params={optIds:optIds};var response=ExtUtil.doAjax({url:_url,params:_params});if(response.logicSuccess){if(response.roleType=="SuperAdmin"){return"SuperAdmin"}else{return response.result}}else{return null}}};ExtUtil=new Ext.ExtUtil();Ext.namespace("Ext.whaty.*");Ext.namespace("Ext.whaty.framework.*");Ext.namespace("Ext.whaty.ux.*");Ext.namespace("Ext.whaty.ux.form.*");Ext.namespace("Ext.whaty.ux.grid.*");Ext.namespace("Ext.whaty.ux.tree.*");Ext.namespace("Ext.whaty.services.*");Ext.namespace("Ext.whaty.services.system.*");ScriptLoader=function(){this.timeout=30;this.scripts=[];this.disableCaching=false};ScriptLoader.prototype={processSuccess:function(response){this.scripts[response.argument.url]=true;window.execScript?window.execScript(response.responseText):window.eval(response.responseText);if(response.argument.options.scripts.length==0){}if(typeof response.argument.callback=="function"){response.argument.callback.call(response.argument.scope)}},processFailure:function(response){Ext.MessageBox.show({title:"Application Error",msg:"Script library could not be loaded.",closable:false,icon:Ext.MessageBox.ERROR,minWidth:200});setTimeout(function(){Ext.MessageBox.hide()},3000)},load:function(url,callback){var cfg,callerScope;if(typeof url=="object"){cfg=url;url=cfg.url;callback=callback||cfg.callback;callerScope=cfg.scope;if(typeof cfg.timeout!="undefined"){this.timeout=cfg.timeout}if(typeof cfg.disableCaching!="undefined"){this.disableCaching=cfg.disableCaching}}if(this.scripts[url]){if(typeof callback=="function"){callback.call(callerScope||window)}return null}Ext.Ajax.request({url:url,success:this.processSuccess,failure:this.processFailure,async:false,scope:this,timeout:(this.timeout*1000),disableCaching:this.disableCaching,argument:{url:url,scope:callerScope||window,callback:callback,options:cfg}})}};ScriptLoaderMgr=function(){this.loader=new ScriptLoader();this.load=function(o){try{ExtUtil.doInit()}catch(e){}var tmpLoader=new ScriptLoader();var tmpScripts=new Array();if(!Ext.isArray(o.scripts)){o.scripts=[]}if(o.scripts.length>0){for(var i=0;i<o.scripts.length;i++){tmpScripts[i]=o.scripts[i]}o.ifiles=0;for(var i=0;i<tmpScripts.length;i++){o.url=tmpScripts[i];o.scope=this;tmpLoader.load(o,function(){o.ifiles++;if(o.ifiles==tmpScripts.length){if(o.callback!=null){o.callback.call(this)}}})}}else{o.callback.call(this)}};this.loadCss=function(scripts){var id="";var file;if(!Ext.isArray(scripts)){scripts=[scripts]}for(var i=0;i<scripts.length;i++){file=scripts[i];id=""+Math.floor(Math.random()*100);Ext.util.CSS.createStyleSheet("",id);Ext.util.CSS.swapStyleSheet(id,file)}};this.addAsScript=function(o){var count=0;var script;var files=o.scripts;if(!Ext.isArray(files)){files=[files]}var head=document.getElementsByTagName("head")[0];Ext.each(files,function(file){script=document.createElement("script");script.type="text/javascript";if(Ext.isFunction(o.callback)){script.onload=function(){count++;if(count==files.length){o.callback.call()}}}script.src=file;head.appendChild(script)})}};ScriptLoaderMgr=new ScriptLoaderMgr();Ext.whaty.framework.ThemeHelper=Ext.extend(Ext.util.Observable,{localmsg:{themeTitle:"Theme",themeSaveText:"Save",themeCancelText:"Cancel",themeConfirmTitle:"Message",themeConfirmText:"Theme Not Save, Exist?",themeDefaultText:"default",themeOliveText:"olive",themePurpleText:"purple",themeChocolateText:"chocolate",themeGrayText:"gray"},themeWindow:null,constructor:function(config){this.resourcePath="resource";if(config!=undefined){if(config.resourcePath!=undefined&&config.resourcePath!=""){this.resourcePath=config.resourcePath}}var curTheme=Ext.util.Cookies.get("xtheme");if(curTheme==undefined){Ext.util.Cookies.set("xtheme","default",new Date(new Date().getTime()+(1000*60*60*24*30)))}this.initThemeWindow();Ext.whaty.framework.ThemeHelper.superclass.constructor.call(config)},initThemeWindow:function(){this.themeTree=new Ext.tree.TreePanel({region:"center",autoScroll:true,loader:new Ext.tree.TreeLoader(),rootVisible:false,root:new Ext.tree.AsyncTreeNode({expanded:true,children:[{text:this.localmsg.themeDefaultText,iconCls:"theme-default",theme:"default",leaf:true},{text:this.localmsg.themeOliveText,iconCls:"theme-olive",theme:"olive",leaf:true},{text:this.localmsg.themePurpleText,iconCls:"theme-purple",theme:"purple",leaf:true},{text:this.localmsg.themeChocolateText,iconCls:"theme-chocolate",theme:"chocolate",leaf:true},{text:this.localmsg.themeGrayText,iconCls:"theme-gray",theme:"gray",leaf:true}]}),listeners:{scope:this,click:this._themeNodeClick}});this.themeWindow=new Ext.Window({title:this.localmsg.themeTitle,layout:"border",width:210,height:330,resizable:false,closable:false,closeAction:"hide",items:[this.themeTree],buttonAlign:"center",buttons:[{text:this.localmsg.themeSaveText,iconCls:"save",scope:this,handler:this._saveThemeToCookie},{text:this.localmsg.themeCancelText,iconCls:"cancel",scope:this,handler:this._cancelTheme}],listeners:{scope:this,show:this._showThemeWindow}})},openThemeWindow:function(){this.themeWindow.show()},initTheme:function(){var theme=Ext.util.Cookies.get("xtheme");this._renderTheme(theme)},_showThemeWindow:function(){var theme=Ext.util.Cookies.get("xtheme");var root=this.themeTree.root;if(theme!=null){root.eachChild(function(node){if(node.attributes.theme==theme){node.select()}})}else{root.firstChild.select()}},_saveThemeToCookie:function(){var node=this.themeTree.getSelectionModel().getSelectedNode();if(!this._isThemeEqCookieTheme()){var theme=node.attributes.theme;Ext.util.Cookies.set("xtheme",theme,new Date(new Date().getTime()+(1000*60*60*24*30)))}this.themeWindow.hide()},_cancelTheme:function(){if(!this._isThemeEqCookieTheme()){Ext.MessageBox.confirm(this.localmsg.themeConfirmTitle,this.localmsg.themeConfirmText,function(btn){if(btn=="yes"){var theme=Ext.util.Cookies.get("xtheme");this._renderTheme(theme);this.themeWindow.hide()}},this)}else{this.themeWindow.hide()}},_themeNodeClick:function(node){var theme=node.attributes.theme;this._renderTheme(theme)},_isThemeEqCookieTheme:function(){var node=this.themeTree.getSelectionModel().getSelectedNode();if(node==null){return true}var curTheme=node.attributes.theme;var cokTheme=Ext.util.Cookies.get("xtheme");if(curTheme==cokTheme){return true}return false},_renderTheme:function(theme){var href=CONTEXT_PATH+"/"+this.resourcePath+"/ext-3.0.0/resources/css/xtheme-"+theme+".css";var htl;if(theme!=null){var frames=window.frames;if(frames!=undefined&&frames!=null&&frames.length>0){for(var i=0;i<frames.length;i++){var idom=frames[i].window.document;var personalStyle=idom.getElementById("personal");if(personalStyle!=undefined){personalStyle.setAttribute("href",href)}}}htl=document.getElementById("personal").setAttribute("href",href);try{var headerDiv=document.getElementById("FWHeaderDiv");if(headerDiv!=null){var headerImage=theme+"-header.jpg";headerDiv.style.background="url("+CONTEXT_PATH+"/resource/image/"+headerImage+") repeat-x;width:100%;height:75px;line-height:75px;"}}catch(e){}try{var footerDiv=document.getElementById("FWFooterDiv");if(footerDiv!=null){var footerImage=theme+"-footer.jpg";footerDiv.style.background="url("+CONTEXT_PATH+"/resource/image/"+footerImage+") width:100%;height:30px;line-height:30px;"}}catch(e){}}}});Ext.whaty.framework.FrameWorkHelper=Ext.extend(Ext.util.Observable,{getContainerInnerWidth:function(){var cmp=Ext.getCmp("FWContainerPanel");if(cmp!=null){return cmp.getInnerWidth()-2}else{return this.getWinVisableWidth()}},getContainerInnerHeight:function(){var cmp=Ext.getCmp("FWContainerPanel");if(cmp!=null){return cmp.getInnerHeight()-2}else{return this.getWinVisableHeight()}},getWinVisableWidth:function(){var winWidth;if(window.innerWidth){winWidth=window.innerWidth}else{if((document.body)&&(document.body.clientWidth)){winWidth=document.body.clientWidth}}if(document.documentElement&&document.documentElement.clientWidth){winWidth=document.documentElement.clientWidth}return winWidth},getWinVisableHeight:function(){var winHeight;if(window.innerHeight){winHeight=window.innerHeight}else{if((document.body)&&(document.body.clientHeight)){winHeight=document.body.clientHeight}}if(document.documentElement&&document.documentElement.clientHeight){winHeight=document.documentElement.clientHeight}return winHeight},openWindow:function(url,param){var height=500;var width=800;var top=(window.screen.availHeight-30-height)/2;var left=(window.screen.availWidth-10-width)/2;window.open(url,"")},initIndexView:function(config,isViewPort){this._decorateConfig(config);if(isViewPort){new Ext.Viewport(config)}else{new Ext.whaty.Panel(config)}},_decorateConfig:function(config){if(config.items){for(var i=0;i<config.items.length;i++){var item=config.items[i];if(item.cmpType=="PageGridPanel"||item.cmpType=="LogicQueryPageGrid"){var searchForm=item.SearchForm;if(searchForm){searchForm.gridId=item.getId();config.items.push(searchForm)}}}}return config}});FrameWorkHelper=new Ext.whaty.framework.FrameWorkHelper();Ext.whaty.framework.MenuPanel=Ext.extend(Ext.Panel,{checked:undefined,menus:null,layout:"accordion",layoutConfig:{titleCollapse:true,activeOnTop:false},initComponent:function(){this.items=this._initMenus();Ext.whaty.framework.MenuPanel.superclass.initComponent.call(this);this.addEvents("menuClick")},_initMenus:function(){if(this.menus!="undefined"&&this.menus!=null){var _menus=[];for(var i=0;i<this.menus.children.length;i++){var item=this.menus.children[i];var children=item.children;var tree=new Ext.tree.TreePanel({root:new Ext.tree.TreeNode({text:"root"}),border:false,rootVisible:false,listeners:{scope:this,click:this._menuLClick}});Ext.each(children,function(child){var _targetType=child.targetType==undefined?"location":child.targetType;var node=new Ext.tree.TreeNode({id:child.menuId,text:child.text,url:child.url,params:child.params,useframe:child.useframe,targetType:_targetType,iconCls:child.iconCls,checked:this.checked,leaf:child.leaf});tree.root.appendChild(node)});_menus.push({title:"<b>"+item.text+"</b>",items:[tree]})}return _menus}else{return[]}},_menuLClick:function(node){if(node.isLeaf()){var param=new Object();param.id=node.id;param.text=node.text;param.url=node.attributes.url;param.params=node.attributes.params;param.useframe=node.attributes.useframe;param.targetType=node.attributes.targetType;this.fireEvent("menuClick",param)}else{node.expand()}}});Ext.whaty.framework.TreeMenuPanel=Ext.extend(Ext.tree.TreePanel,{localmsg:{expandTooltipText:"Expand All",collapseTooltipText:"Collapse All",searchBtnText:"Search"},allowSearch:true,allowExpand:true,checked:undefined,menus:[],rootVisible:false,autoScroll:true,toolbar:[],initComponent:function(){this._initMenus();this.tbar=this._initToolBar();Ext.whaty.framework.TreeMenuPanel.superclass.initComponent.call(this);this.addEvents("menuClick");this.on("click",this._menuLClick)},_initToolBar:function(){var _bar=[];if(this.allowSearch){this.searchInput=new Ext.form.TextField({hideLabel:true});this.searchBtn=new Ext.Button({iconCls:"query",tooltip:this.localmsg.searchBtnText,listeners:{scope:this,click:this._doSearch}});this.treeFilter=new Ext.tree.TreeFilter(this,{clearBlank:true,autoClear:true});this.keys=[{key:Ext.EventObject.ENTER,fn:this._doSearch,scope:this}];_bar.push(this.searchInput);_bar.push(this.searchBtn);_bar.push("->")}if(this.allowExpand){this.expandBtn=new Ext.Button({iconCls:"expand-all",myValue:"expand",tooltip:this.localmsg.expandTooltipText,scope:this,handler:this._doExpandCollapse});_bar.push(this.expandBtn)}if(this.toolbar!=null&&this.toolbar.length>0){for(var i=0;i<this.toolbar.length;i++){_bar.push(this.toolbar[i])}}return _bar},_doExpandCollapse:function(btn){if(btn.myValue=="expand"){btn.setIconClass("collapse-all");this.expandAll();btn.myValue="collapse";btn.setTooltip(this.localmsg.collapseTooltipText)}else{btn.setIconClass("expand-all");this.collapseAll();btn.myValue="expand";btn.setTooltip(this.localmsg.expandTooltipText)}},reloadTreeMenu:function(menus){this.menus=menus;if(this.root!=null&&this.root.childNodes.length>0){while(this.root.hasChildNodes()){this.root.removeChild(this.root.firstChild)}}this._initMenus();if(this.expandBtn!=undefined&&this.expandBtn!=null){var btn=this.expandBtn;btn.setIconClass("expand-all");btn.myValue="expand";btn.setTooltip(this.localmsg.expandTooltipText)}},_initMenus:function(){if(this.menus!="undefined"&&this.menus!=null){var _menus=this.menus;if(this.root==null){this.root=new Ext.tree.TreeNode({text:_menus.text,id:"root",checked:this.checked,leaf:false,expanded:true})}var _root=this.root;this._appendChild(_root,_menus.children)}else{this.root=new Ext.tree.TreeNode({text:"root",id:"root"})}},_appendChild:function(root,children){var _this=this;Ext.each(children,function(child){var _targetType=child.targetType==undefined?"location":child.targetType;var node=new Ext.tree.TreeNode({id:child.menuId,text:child.text,url:child.url,params:child.params,useframe:child.useframe,targetType:_targetType,iconCls:child.iconCls,checked:_this.checked,leaf:child.leaf});root.appendChild(node);if(child.leaf!=null&&child.leaf!=undefined){_this._appendChild(node,child.children)}else{return}})},_menuLClick:function(node){if(node.isLeaf()){var param=new Object();param.id=node.id;param.text=node.text;param.url=node.attributes.url;param.params=node.attributes.params;param.useframe=node.attributes.useframe;param.targetType=node.attributes.targetType;this.fireEvent("menuClick",param)}else{node.expand()}},_doSearch:function(){var text=this.searchInput.getValue();if(!ExtUtil.isEmpty(text)){var re=new RegExp(Ext.escapeRe(text),"i");this.treeFilter.filterBy(function(n){return !n.isLeaf()||re.test(n.text)});this.expandAll()}else{this.treeFilter.clear()}}});function configTheme(){}Ext.whaty.framework.HeaderPanel=Ext.extend(Ext.Panel,{border:false,initComponent:function(){Ext.whaty.framework.HeaderPanel.superclass.initComponent.call(this)},loadHeaderPanel:function(param){var url=null;var params=null;if(typeof param=="object"){url=param.url;params=param.params}else{url=param}if(url!=null&&url!=undefined){this.load({url:url,method:"post",params:params,scope:this,discardUrl:true,nocache:true,scripts:true,timeout:3000,text:"Load..."})}}});Ext.whaty.framework.FooterPanel=Ext.extend(Ext.Panel,{border:false,initComponent:function(){Ext.whaty.framework.FooterPanel.superclass.initComponent.call(this)},loadFooterPanel:function(param){var url=null;var params=null;if(typeof param=="object"){url=param.url;params=param.params}else{url=param}if(url!=null&&url!=undefined){this.load({url:url,method:"post",params:params,scope:this,discardUrl:true,nocache:true,scripts:true,timeout:3000,text:"Load..."})}}});Ext.whaty.framework.ContainerPanel=Ext.extend(Ext.Panel,{layout:"card",border:false,activeItem:0,id:"FWContainerPanel",initComponent:function(){this.extPanel=new Ext.Panel();this.iframePanel=new Ext.Panel({title:" ",html:'<iframe id="FWContainerPanelFrame" frameborder="0" width="100%" height="100%" src=""></iframe>'});this.items=[this.extPanel,this.iframePanel];Ext.whaty.framework.ContainerPanel.superclass.initComponent.call(this)},loadMainContentPanel:function(param){var url=null;var params=null;var frame=false;var targetType="location";if(typeof param=="object"){url=param.url;params=param.params;frame=param.useframe==undefined?false:param.useframe;targetType=param.targetType}else{url=param}url=this.getContextPathUrl(url);if(targetType==undefined||targetType=="location"){if(!frame){this.getLayout().setActiveItem(0);if(url!=null&&url!=undefined&&url!=""){this.extPanel.load({url:url,method:"post",params:params,scope:this,discardUrl:true,nocache:true,scripts:true,timeout:3000,text:"Load..."})}}else{this.getLayout().setActiveItem(1);if(typeof param=="object"){this.iframePanel.setTitle(param.text)}var iframe=document.getElementById("FWContainerPanelFrame");iframe.setAttribute("src",url)}}else{if(targetType=="open"){FrameWorkHelper.openWindow(url)}else{alert("targetType is not correct ")}}},getContextPathUrl:function(url){if(ExtUtil.isEmpty(url)){return CONTEXT_PATH+"/common/blank.jsp"}if(url.indexOf("http:")>-1||url.indexOf("https:")>-1||url.indexOf("www.")>-1){}else{if(url.indexOf(CONTEXT_PATH)==-1){url=CONTEXT_PATH+url}}return url}});Ext.whaty.framework.ContainerTabPanel=Ext.extend(Ext.TabPanel,{localmsg:{maskInfoText:"Loading...",menuCloseText:"Close",menuCloseOtherText:"Close Others",menuCloseAllText:"Close All",menuRefreshText:"Refresh"},id:"FWContainerPanel",forceLayout:true,deferredRender:false,enableTabScroll:true,layoutOnTabChange:false,initComponent:function(){this.contextmenu=new Ext.menu.Menu({items:[{text:this.localmsg.menuCloseText,iconCls:"close",scope:this,handler:this._closeCurrentTab},{text:this.localmsg.menuCloseOtherText,iconCls:"close",scope:this,handler:this._closeOtherTab},{text:this.localmsg.menuCloseAllText,iconCls:"close",scope:this,handler:this._closeAllTab},"-",{text:this.localmsg.menuRefreshText,iconCls:"refresh",scope:this,handler:this._handlRefresh}]});Ext.whaty.framework.ContainerTabPanel.superclass.initComponent.call(this);this.on("contextmenu",this._contextmenu)},_contextmenu:function(tabpanel,tab,e){this.currentTab=tab;e.preventDefault();this.contextmenu.showAt(e.getXY())},_closeCurrentTab:function(){if(this.currentTab!=null&&this.currentTab!=undefined){this.remove(this.currentTab)}},_closeOtherTab:function(){var _items=new Array();for(var i=0;i<this.items.length;i++){var item=this.items.itemAt(i);if(item!=this.currentTab){_items.push(item)}}for(var i=0;i<_items.length;i++){this.remove(_items[i])}},_closeAllTab:function(){this.removeAll()},_handlRefresh:function(){var tab=this.currentTab;this._refreshTabPanel(tab)},_refreshTabPanel:function(tab){this.setActiveTab(tab);var param=tab.myParam;var useframe=param.useframe;var tabId=param.id;if(useframe){var iframe=document.getElementById("TabIframe-"+tabId);iframe.contentWindow.location.reload()}else{var url=this.getContextPathUrl(param.url);tab.load({url:url,method:"post",params:param.params,scope:this,discardUrl:true,nocache:false,scripts:true,timeout:3000,text:"Load..."})}},loadMainContentPanel:function(param){var url=null;var params=null;var useframe=false;if(typeof param!="object"){alert("参数必须为object类型");return}url=param.url;params=param.params;useframe=param.useframe==undefined?false:param.useframe;url=this.getContextPathUrl(url);if(url!=null&&url!=undefined&&url!=""){var targetType=param.targetType;if(targetType==undefined||targetType=="location"){var nId=param.id;if(param.menuId!=null&&param.menuId!=undefined){nId=param.menuId}var t=this.getItem(nId);if(t){t.show()}else{if(useframe){var tab=this.add(new Ext.Panel({myParam:param,html:'<iframe id="TabIframe-'+nId+'" frameborder="0" width="100%" height="100%" src="'+url+'"></iframe>',title:param.text,id:nId,autoload:true,closable:true,autoScroll:true,border:false}));this.setActiveTab(tab)}else{var fwPanel=Ext.getCmp("WhatyFrameWorkViewport");if(fwPanel!=null){fwPanel.getEl().mask(this.localmsg.maskInfoText,"x-mask-loading")}var tab=this.add(new Ext.Panel({myParam:param,title:param.text,id:nId,closable:true,autoScroll:true,border:false,autoload:true}));this.setActiveTab(tab);try{tab.load({url:url,method:"post",params:params,scope:this,discardUrl:true,nocache:false,scripts:true,callback:function(){tab.doLayout(true);if(fwPanel!=null){fwPanel.getEl().mask().remove()}},text:"Load..."})}catch(e){if(fwPanel!=null){fwPanel.getEl().mask().remove()}}}}}else{if(targetType=="open"){FrameWorkHelper.openWindow(url)}else{alert("attribute targetType is not correct ")}}}},reloadMainContentPanel:function(param){var tabId=param.id;if(param.menuId!=null&&param.menuId!=undefined){tabId=param.menuId}var tab=this.findById(tabId);if(tab){this.setActiveTab(tab);var useframe=param.useframe;if(useframe){var iframe=document.getElementById("TabIframe-"+tabId);iframe.contentWindow.location.reload()}else{var url=this.getContextPathUrl(param.url);tab.load({url:url,method:"post",params:param.params,scope:this,discardUrl:true,nocache:false,scripts:true,timeout:3000,text:"Load..."})}}else{this.loadMainContentPanel(param)}},closeTabPanelById:function(tabId){if(tabId!=undefined){var tab=this.findById(tabId);if(tab){this.remove(tab)}else{alert("tab is null")}}else{ExtUtil.alert("tab id is undefined")}},closeCurrentTabPanel:function(){var curTab=this.getCurrentTab();if(curTab!=null){this.remove(curTab)}},refreshCurrentTabPanel:function(){var curTab=this.getCurrentTab();if(curTab!=null){this._refreshTabPanel(curTab)}},refreshTabPanelById:function(tabId){if(tabId!=undefined){var tab=this.findById(tabId);if(tab){this._refreshTabPanel(tab)}else{alert("tab is null")}}else{ExtUtil.alert("tab id is undefined")}},getCurrentTab:function(){if(this.currentTab!=null&&this.currentTab!=undefined){return this.currentTab}else{return this.getActiveTab()}},getTabPanelById:function(tabId){if(tabId!=undefined){var tab=this.findById(tabId);if(tab){this._refreshTabPanel(tab)}else{return null}}else{ExtUtil.alert("tab id is undefined")}},getContextPathUrl:function(url){if(ExtUtil.isEmpty(url)){return CONTEXT_PATH+"/common/blank.jsp"}if(url.indexOf("http:")>-1||url.indexOf("https:")>-1||url.indexOf("www.")>-1){}else{if(url.indexOf(CONTEXT_PATH)==-1){url=CONTEXT_PATH+url}}return url}});Ext.whaty.framework.FrameWorkViewport=Ext.extend(Ext.Viewport,{id:"WhatyFrameWorkViewport",localmsg:{navigationMenuText:"Menus"},header:true,footer:true,menuNavigation:true,centerConfig:null,layout:"border",menus:[],menuType:"Accordion",containerType:"Panel",initComponent:function(){var _items=[];if(this.header){this.headerPanel=new Ext.whaty.framework.HeaderPanel({region:"north",height:50});_items.push(this.headerPanel)}this.containerPanel=this._createContainerPanel();var config={region:"center",layout:"border",items:[this.containerPanel]};if(this.menuNavigation){this.menuPanel=this._createMenuPanel();config.items.push(this.menuPanel)}if(this.centerConfig!=null){Ext.applyIf(config,this.centerConfig)}this.centerPanel=new Ext.Panel(config);_items.push(this.centerPanel);if(this.footer){this.footerPanel=new Ext.whaty.framework.FooterPanel({region:"south",height:30});_items.push(this.footerPanel)}this.items=_items;Ext.whaty.framework.FrameWorkViewport.superclass.initComponent.call(this);this.on("resize",this.handleResize,this)},handleResize:function(cmp,adjWidth,adjHeight,rawWidth,rawHeight){},onRender:function(ct,position){this._init();Ext.whaty.framework.FrameWorkViewport.superclass.onRender.call(this,ct,position)},_createMenuPanel:function(){switch(this.menuType){case"Accordion":return new Ext.whaty.framework.MenuPanel({id:"FWNavigationPanel",title:this.localmsg.navigationMenuText,region:"west",width:250,maxWidth:250,minWidth:250,split:true,menus:this.menus,listeners:{scope:this,menuClick:this._menuClick}});break;case"Tree":return new Ext.whaty.framework.TreeMenuPanel({id:"FWNavigationPanel",title:this.localmsg.navigationMenuText,region:"west",width:250,maxWidth:250,minWidth:250,split:true,menus:this.menus,listeners:{scope:this,menuClick:this._menuClick}});break;default:return new Ext.Panel({region:"west",width:250,maxWidth:250,minWidth:250});break}},_createContainerPanel:function(){switch(this.containerType){case"Panel":return new Ext.whaty.framework.ContainerPanel({region:"center"});break;case"TabPanel":return new Ext.whaty.framework.ContainerTabPanel({region:"center"});break;default:return new Ext.Panel({region:"center"});break}},_init:function(){ThemeHelper.initTheme()},_menuClick:function(param){this.loadContainerPanel(param)},loadContainerPanel:function(arg0,arg1,arg2){if(arg0!=null&&arg0!=undefined){if(this.containerPanel!=null&&this.containerPanel.loadMainContentPanel!=undefined){this.containerPanel.loadMainContentPanel(arg0)}else{alert("Container为空或者书写不正确，请确认containerType是否书写正确")}}if(this.header&&arg1!=null&&arg1!=undefined){if(this.headerPanel!=undefined&&this.headerPanel!=null&&this.headerPanel.loadHeaderPanel!=undefined){this.headerPanel.loadHeaderPanel(arg1)}else{alert("HeaderPanel为空或者书写不正确")}}if(this.footer&&arg2!=null&&arg2!=undefined){if(this.footerPanel!=undefined&&this.footerPanel!=null&&this.footerPanel.loadFooterPanel!=undefined){this.footerPanel.loadFooterPanel(arg2)}else{alert("FooterPanel为空或者书写不正确")}}},reloadContainerPanel:function(param){this.containerPanel.reloadMainContentPanel(param)}});Ext.whaty.Panel=Ext.extend(Ext.Panel,{OptIds:[],border:false,forceLayout:true,onRender:function(ct,position){this.setWidth(FrameWorkHelper.getContainerInnerWidth());this.setHeight(FrameWorkHelper.getContainerInnerHeight());Ext.whaty.Panel.superclass.onRender.call(this,ct,position);ExtUtil.filterPriority(window._OPT_IDS)}});Ext.whaty.ux.form.WhatyTextField=Ext.extend(Ext.form.TextField,{tooltip:{},onRender:function(ct,position){Ext.whaty.ux.form.WhatyTextField.superclass.onRender.call(this,ct,position);if(this.tooltip.text){new Ext.ToolTip({target:this.id,dismissDelay:10000,hideDelay:0,trackMouse:true,maxWidth:300,minWidth:100,title:this.tooltip.title,html:this.tooltip.text})}}});Ext.reg("whatytextfield",Ext.whaty.ux.form.WhatyTextField);Ext.whaty.ux.form.WhatyComboBox=Ext.extend(Ext.form.ComboBox,{xtype:"whatycombobox",cbtype:"form",ck:false,mode:"local",triggerAction:"all",displayField:"text",valueField:"value",readOnly:true,allowEmpty:true,emptyText:"Choose",jsonData:{},proxyUrl:null,params:null,autoLoad:false,selectedValues:[],selectedTexts:[],selectOnFocus:true,pageSize:10,allowPage:true,initComponent:function(){if(!this.allowPage){this.pageSize=0}this.selectedValues=new Array();this.selectedTexts=new Array();if(this.proxyUrl!=null&&this.proxyUrl!=""){if(this.autoLoad){this.successLoaded=true}this.store=new Ext.data.JsonStore({fields:[this.displayField,this.valueField,"checked"],root:"root",totalProperty:"totalCount",pageSize:this.pageSize,autoLoad:this.autoLoad,url:this.proxyUrl,listeners:{scope:this,load:this._onLoad}});if(this.pageSize!=undefined&&this.pageSize!=null&&this.pageSize>0){this.store.baseParams={start:0,limit:this.pageSize};this._setBaseParams()}}else{this.pageSize=0;this.store=new Ext.data.JsonStore({fields:[this.displayField,this.valueField,"checked"],root:"root"});var _root=this.jsonData.root;this._doWithJsonData();this.store.loadData(this.jsonData)}if(this.ck){this.createTemplate()}Ext.whaty.ux.form.WhatyComboBox.superclass.initComponent.call(this);this.on("focus",this._handleFocus);this.addEvents("afterLoad")},_setBaseParams:function(){this.setBaseParams(this.params)},setBaseParams:function(params){if(params&&typeof params=="object"){for(var p in params){this.store.baseParams[p]=params[p]}}},resetLoaded:function(flag){if(this.successLoaded==undefined){this.successLoaded=false}if(flag==undefined){this.successLoaded=false}else{this.successLoaded=flag}},_onLoad:function(store,records,options){if(records!=null&&records.length>0){for(var i=0;i<records.length;i++){var record=records[i];for(var j=0;j<this.selectedValues.length;j++){if(record.get(this.valueField)==this.selectedValues[j]){record.set("checked",true)}}}this.fireEvent("afterLoad",records)}},_unshiftEmptyRecord:function(records){if(records.length>0){var data=records[0].data;if(data[this.displayField]!=this.emptyText){var obj=new Object();obj.checked="";obj[this.valueField]="";obj[this.displayField]=this.emptyText;records.unshift(new Ext.data.Record(obj))}}},createTemplate:function(){var value=this.valueField;var text=this.displayField;this.tpl=new Ext.XTemplate('<tpl for="."><div class="x-combo-list-item"><span><input type="checkbox" {[values.checked?"checked":""]} value="{[values.'+value+']}" /></span><span >{'+text+"}</span></div></tpl>")},reloadJsonData:function(jsonData,value){var store=this.getStore();var _root=jsonData.root;this.jsonData=jsonData;this._doWithJsonData();store.loadData(jsonData);this.setValue(value)},setComboxValue:function(texts,values){this.setCkCombobboxValues(texts,values)},_doWithJsonData:function(){if(this.allowEmpty){if(!this.ck){this._unshiftEmptyText()}if(this.cbtype=="search"){this._unshiftEmptyText()}}if(this.ck){this._doWithCkData()}},_unshiftEmptyText:function(){if(this.jsonData.root[0][this.displayField]!=this.emptyText){var obj=new Object();obj[this.displayField]=this.emptyText;obj[this.valueField]="";this.jsonData.root.unshift(obj)}},_doWithCkData:function(){var arr=this.jsonData.root;if(arr!=null&&arr.length>0){for(var i=0;i<arr.length;i++){var record=arr[i];if(record.checked){this.selectedValues.push(record.value);this.selectedTexts.push(record.text)}}this.setValue(this.selectedTexts.join(","))}},loadData:function(){if(!this.successLoaded){this.store.baseParams[this.queryParam]=this.allQuery;this._setBaseParams();this.store.load({params:this.getParams(this.allQuery)});this.successLoaded=true}},reloadData:function(){this.successLoaded=false;this.resetSelectedRecord();this.loadData()},getSelectedValue:function(){if(this.ck){return this.selectedValues.join(",")}else{alert("ck attribute is not true, please use getRowValue ")}},getSelectedText:function(){if(this.ck){return this.selectedTexts.join(",")}else{alert("ck attribute is not true, please use getRowValue")}},onTriggerClick:function(){if(this.disabled){return}if(this.isExpanded()){this.collapse();this.el.focus()}else{this.onFocus({});if(this.proxyUrl!=null&&this.proxyUrl!=""){if(!this.successLoaded){if(this.triggerAction=="all"){this.doQuery(this.allQuery,true)}else{this.doQuery(this.getRawValue())}this.successLoaded=true}else{this.expand()}}else{this.doQuery(this.allQuery,true);this.expand()}this.el.focus()}},_handleFocus:function(_combo){if(_combo.proxyUrl!=null&&_combo.proxyUrl!=""){if(!this.successLoaded){_combo.loadData()}}if(!_combo.disabled){_combo.initList();_combo.expand()}if(_combo.readOnly){_combo.blur()}},onSelect:function(record,index){if(this.ck){if(this.fireEvent("beforeselect",this,record,index)!==false){record.set("checked",!record.get("checked"));if(record.get("checked")){this.selectedValues.push(record.get(this.valueField));this.selectedTexts.push(record.get(this.displayField))}else{this.selectedValues.remove(record.get(this.valueField));this.selectedTexts.remove(record.get(this.displayField))}this.setValue(this.selectedTexts.join(","));if(this.hiddenField!=undefined){this.hiddenField.value=this.selectedValues.join(",")}}}else{Ext.whaty.ux.form.WhatyComboBox.superclass.onSelect.call(this,record,index)}},setCkCombobboxValues:function(texts,values){if(typeof texts=="string"&&typeof values=="string"){this.setRemoteParams(null,texts.split(","),values.split(","))}else{this.setRemoteParams(null,texts,values)}},setRemoteParams:function(arg0,arg1,arg2){if(arg0!=null&&arg0!=undefined&&typeof arg0=="object"){this.setBaseParams(arg0)}if(arg1!=null&&arg1!=undefined&&typeof arg1=="object"&&arg2!=null&&arg2!=undefined&&typeof arg2=="object"){this.selectedTexts=new Array();this.selectedTexts=this.selectedTexts.concat(arg1);this.selectedValues=new Array();this.selectedValues=this.selectedValues.concat(arg2);this.setValue(this.selectedTexts.join(","));if(this.hiddenField!=undefined){this.hiddenField.value=this.selectedValues.join(",")}}else{this.selectedTexts=new Array();this.selectedValues=new Array();this.setValue("");if(this.hiddenField!=undefined){this.hiddenField.value=""}}var store=this.store;var _valueField=this.valueField;for(var i=0;i<this.selectedValues.length;i++){var value=this.selectedValues[i];store.each(function(record){if(value==record.get(_valueField)){record.set("checked",true)}})}this.successLoaded=false},setComboboxHiddenValue:function(){var _name=this.name;var _hiddenName=this.hiddenName;var obj=new Object();var text="";if(!ExtUtil.isEmpty(_name)&&_name!=_hiddenName){if(this.ck){this.setValue(this.selectedValues.join(","));text=this.selectedTexts.join(",")}else{text=this.getRawValue()}obj[_name]=text;return obj}return null},setComboboxText:function(){var _name=this.name;var _hiddenName=this.hiddenName;if(!ExtUtil.isEmpty(_name)&&_name!=_hiddenName){if(this.ck){this.setValue(this.selectedTexts.join(","))}}},resetSelectedRecord:function(){this.setValue(null);if(this.ck){this.selectedValues=[];this.selectedTexts=[];var store=this.store;store.each(function(record){record.set("checked",false)})}}});Ext.reg("whatycombobox",Ext.whaty.ux.form.WhatyComboBox);Ext.namespace("Ext.whaty.ux.form.*");Ext.whaty.ux.form.BaseForm=Ext.extend(Ext.form.FormPanel,{timeout:1000,localmsg:{saveText:"Save",resetText:"Reset",cancelText:"Cancel",msgTitle:"Message",maskInfoText:"saving...",saveSuccessText:"Save Success",saveFailureText:"Save Failure"},actionUrl:"",extraParams:{},frame:true,autoScroll:true,labelAlign:"right",buttonAlign:"center",fieldWidth:220,needFlag:"<font color=red>*</font>",initComponent:function(){this._initFormField();Ext.whaty.ux.form.BaseForm.superclass.initComponent.call(this);this.addEvents("submitSuccess","submit","afterSubmit")},_initFormField:function(){var items=this.items;if(items!=null&&items!=undefined&&items.length>0){for(var i=0;i<items.length;i++){var item=items[i];if(item.allowBlank!=undefined&&!item.allowBlank){item.fieldLabel=item.fieldLabel+this.needFlag}}}},getBaseFormValue:function(){var form=this.getForm();if(form.isValid()){var returnObj=form.getValues();var cbs=this.findByType("combo");for(var i=0;i<cbs.length;i++){if(!ExtUtil.isEmpty(cbs[i].name)){returnObj[cbs[i].name]=cbs[i].getRawValue()}if(!ExtUtil.isEmpty(cbs[i].hiddenName)){returnObj[cbs[i].hiddenName]=cbs[i].getValue()}}var wcbs=this.findByType("whatycombobox");for(var i=0;i<wcbs.length;i++){var wcb=wcbs[i];if(wcb.ck){if(!ExtUtil.isEmpty(cbs[i].name)){returnObj[wcb.name]=wcb.selectedTexts.join(",")}if(!ExtUtil.isEmpty(cbs[i].hiddenName)){returnObj[wcb.hiddenName]=wcb.selectedValues.join(",")}}else{if(!ExtUtil.isEmpty(cbs[i].name)){returnObj[wcb.name]=wcb.getRawValue()}if(!ExtUtil.isEmpty(cbs[i].hiddenName)){returnObj[wcb.hiddenName]=wcb.getValue()}}}return returnObj}else{return null}},_getComboboxNameValue:function(){var returnObj=new Object();var cbs=this.findByType("combo");for(var i=0;i<cbs.length;i++){if(!ExtUtil.isEmpty(cbs[i].name)){returnObj[cbs[i].name]=cbs[i].getRawValue()}}var wcbs=this.findByType("whatycombobox");for(var i=0;i<wcbs.length;i++){var wcb=wcbs[i];if(wcb.ck){if(!ExtUtil.isEmpty(cbs[i].name)){returnObj[wcb.name]=wcb.selectedTexts.join(",")}}else{if(!ExtUtil.isEmpty(cbs[i].name)){returnObj[wcb.name]=wcb.getRawValue()}}}return returnObj},_setComboboxText:function(isHiddenValue){var wcbs=this.findByType("whatycombobox");for(var i=0;i<wcbs.length;i++){var wcb=wcbs[i];if(wcb.ck){if(isHiddenValue){for(var i=0;i<wcbs.length;i++){wcbs[i].setComboboxHiddenValue()}}else{for(var i=0;i<wcbs.length;i++){wcbs[i].setComboboxText()}}}}},_filterFormValues:function(value){for(var p in value){if(p.indexOf("ext-comp-")==0){value[p]=null}}},loadFormValue:function(_myObject){var data=new Object();var items=this.items.items;if(items.length>0){for(var i=0;i<items.length;i++){var item=items[i];var name=item.name;if(item.xtype=="whatycombobox"){this.loadWhatycomboboxData(item,_myObject)}else{data[name]=eval("_myObject."+name)}}}var record=new Ext.data.Record(data);this.getForm().loadRecord(record)},loadWhatycomboboxData:function(combo,_myObject){var name=combo.name;var hiddenName=combo.hiddenName;var text=eval("_myObject."+name);var value=eval("_myObject."+hiddenName);if(combo.ck){if(text!=null&&text!=""&&text!="null"){if(typeof text=="string"){combo.setCkCombobboxValues(text,value)}else{var _tmpTtexts=[];var _tmpvalues=[];var displayField=combo.displayField;var valueField=combo.valueField;for(var i=0;i<text.length;i++){_tmpTtexts.push(text[i][displayField]);_tmpvalues.push(text[i][valueField])}combo.setCkCombobboxValues(_tmpTtexts,_tmpvalues)}}}else{if(text==null||text==""||text=="null"){combo.setValue(value)}else{combo.setValue(text)}if(combo.hiddenField!=undefined){combo.hiddenField.value=value}}},submitForm:function(){var form=this.getForm();if(form.isValid()){this.getEl().mask(this.localmsg.maskInfoText,"x-mask-loading");var cbNameValues=this._getComboboxNameValue();if(this.extraParams==null){this.extraParams=new Object()}for(var p in cbNameValues){this.extraParams[p]=cbNameValues[p]}this._setComboboxText(true);form.submit({scope:this,params:this.extraParams,url:this.actionUrl,success:function(form,action){var response=action.response;if(response.responseJSON==undefined){response.responseJSON=Ext.util.JSON.decode(response.responseText)}var logicSuccess=response.responseJSON.logicSuccess;if(logicSuccess){ExtUtil.alert(this.localmsg.msgTitle,this.localmsg.saveSuccessText,this.timeout);this.fireEvent("submitSuccess",response.responseJSON)}else{ExtUtil.alert(this.localmsg.msgTitle,this.localmsg.saveFailureText,this.timeout)}this.fireEvent("submit",logicSuccess);this.fireEvent("afterSubmit",logicSuccess);this.getEl().mask().remove();this._setComboboxText(false)},failure:function(){ExtUtil.alert(this.localmsg.msgTitle,this.localmsg.saveFailureText,this.timeout);this.fireEvent("submit",false);this.fireEvent("afterSubmit",false);this.getEl().mask().remove();this._setComboboxText(false)}})}},resetForm:function(){this.getForm().reset();var wcbs=this.findByType("whatycombobox");for(var i=0;i<wcbs.length;i++){var wcb=wcbs[i];wcb.resetSelectedRecord()}},setFormValueWithObject:function(object,beanPrefixName){var length=arguments.length;if(length==2){var data=new Object();for(property in object){data[beanPrefixName+"."+property]=object[property]}var record=new Ext.data.Record(data);this.getForm().loadRecord(record)}else{var record=new Ext.data.Record(object);this.getForm().loadRecord(record)}},setFormValueWithRecord:function(record){this.getForm().loadRecord(record)},setFormValue:function(data,isRecord){var length=arguments.length;if(length==1){this.getForm().loadRecord(data)}else{if(isRecord){this.getForm().loadRecord(data)}else{var record=new Ext.data.Record(data);this.getForm().loadRecord(record)}}},getFormValue:function(){var form=this.getForm();if(form.isValid()){var returnObj=form.getValues();var cbs=this.findByType("combo");for(var i=0;i<cbs.length;i++){returnObj[cbs[i].name]=cbs[i].getValue()}var wcbs=this.findByType("whatycombobox");for(var i=0;i<wcbs.length;i++){returnObj[wcbs[i].name]=wcbs[i].getValue()}return returnObj}else{return null}},setExtraParams:function(){}});Ext.namespace("Ext.whaty.ux.form.*");Ext.whaty.ux.form.LogicBaseForm=Ext.extend(Ext.whaty.ux.form.BaseForm,{localmsg:{blankText:" Is Required ",invalidText:" Invalid "},beanPrefixName:null,fieldItems:[],initComponent:function(){if(this.fieldItems!=null&&this.fieldItems.length>0){if(this.beanPrefixName==null){this.beanPrefixName="entityBean"}this.items=this.initFormItems()}Ext.whaty.ux.form.LogicBaseForm.superclass.initComponent.call(this)},initFormItems:function(){var items=[];for(var i=0;i<this.fieldItems.length;i++){var field=this.fieldItems[i];if(field.fieldtype!=undefined&&field.fieldtype!=null&&field.fieldtype!=""){var obj=new Object();if(field.fieldtype=="whatycombobox"){obj=this._createCombobox(field);if(obj==null){return}}else{if(field.fieldtype=="checkboxgroup"||field.fieldtype=="radiogroup"){obj=this._createCheckboxgroup(field);if(obj==null){return}}else{obj.xtype=field.fieldtype}}this._applyFieldAttr(obj,field);if(!obj.physicalHidden){items.push(obj)}}}return items},_createCheckboxgroup:function(field){if(!this.isObjectEmpty(field.fieldAttr)&&!this.isObjectEmpty(field.fieldAttr.items)){alert("请设置fieldAttr或者fieldAttr的items属性");return null}var fieldAttr=field.fieldAttr;var obj=new Object();obj.fieldLabel=field.header;obj.xtype=field.fieldtype;this._applyFieldAttr(obj,field);return obj},_createCombobox:function(field){var url=field.fieldAttr.url;var jsonData=field.fieldAttr.jsonData;if(url==undefined){url=null;if(jsonData==undefined){alert("请赋值url,或者 jsonData");return null}}var _hiddenName=field.fieldAttr.hiddenName;if(_hiddenName!=undefined&&_hiddenName!=""){_hiddenName=this._getFiledName(_hiddenName)}else{if(field.fieldAttr.fullHiddenName!=undefined){_hiddenName=field.fieldAttr.fullHiddenName}else{alert("请在fieldAttr中添加hiddenName属性或者fullHiddenName属性");return null}}var _name=field.fieldAttr.fieldName;if(_name!=undefined&&_name!=""){_name=this._getFiledName(_name)}var _value=field.fieldAttr.value;var _ck=field.fieldAttr.ck;var displayField="text";var valueField="value";if(field.fieldAttr.displayField!=undefined&&field.fieldAttr.displayField!=""){displayField=field.fieldAttr.displayField}if(field.fieldAttr.valueField!=undefined&&field.fieldAttr.valueField!=""){valueField=field.fieldAttr.valueField}var _whatyCombobox=new Object({cbtype:"form",xtype:"whatycombobox",proxyUrl:url,ck:_ck,displayField:displayField,valueField:valueField,jsonData:jsonData,value:_value,name:_name,hiddenName:_hiddenName});if(field.fieldAttr.pageSize!=undefined){_whatyCombobox.pageSize=field.fieldAttr.pageSize}Ext.applyIf(_whatyCombobox,field.fieldAttr);return _whatyCombobox},setComboboxHiddenValue:function(){var arr=[];var wcbs=this.findByType("whatycombobox");for(var i=0;i<wcbs.length;i++){var obj=wcbs[i].setComboboxHiddenValue();if(obj!=null){arr.push(obj)}}return arr},setComboboxText:function(){var wcbs=this.findByType("whatycombobox");for(var i=0;i<wcbs.length;i++){wcbs[i].setComboboxText()}},_applyFieldAttr:function(obj,field){var fieldAttr=field.fieldAttr;obj.fieldLabel=field.header;if(fieldAttr==undefined){obj.name=this._getFiledName(field.dataIndex)}else{if(fieldAttr.fieldId!=undefined){obj.id=fieldAttr.fieldId}if(fieldAttr.id!=undefined){obj.id=fieldAttr.id}obj.width=this.fieldWidth;if(fieldAttr.fieldName!=undefined){obj.name=this._getFiledName(fieldAttr.fieldName)}if(fieldAttr.fullFieldName!=undefined){obj.name=fieldAttr.fullFieldName}obj.name=this._getFiledName(field.dataIndex);if(fieldAttr.inputType!=undefined){obj.inputType=fieldAttr.inputType;if(fieldAttr.inputType=="file"){this.fileUpload=true}}if(fieldAttr.fieldLabel!=undefined){obj.fieldLabel=fieldAttr.fieldLabel}if(fieldAttr.allowBlank!=undefined){obj.allowBlank=fieldAttr.allowBlank;obj.blankText=fieldAttr.blankText==undefined?field.header+this.localmsg.blankText:fieldAttr.blankText}if(fieldAttr.regex!=undefined){obj.regex=fieldAttr.regex;obj.regexText=fieldAttr.regexText==undefined?field.header+this.localmsg.invalidText:fieldAttr.regexText}if(fieldAttr.hidden){obj.hideLabel=true}if(field.fieldtype=="checkboxgroup"||field.fieldtype=="radiogroup"){var items=field.fieldAttr.items;for(var i=0;i<items.length;i++){var item=items[i];item.name=obj.name}}Ext.applyIf(obj,fieldAttr)}},_getFiledName:function(name){return this.beanPrefixName==null?name:this.beanPrefixName+"."+name},isObjectEmpty:function(obj){if(obj!=undefined&&obj!=null&&obj!=""){return true}return false}});Ext.namespace("Ext.whaty.ux.form.*");Ext.whaty.ux.form.BaseSearchForm=Ext.extend(Ext.whaty.ux.form.BaseForm,{localmsg:{searchText:"Search",searchResetText:"Reset"},animCollapse:false,layout:"form",forceLayout:true,frame:true,autoScroll:true,labelAlign:"right",buttonAlign:"right",initComponent:function(){this.searchBtn=new Ext.Button({text:this.localmsg.searchText,iconCls:"query",listeners:{scope:this,click:this._doSearch}});this.resetBtn=new Ext.Button({text:this.localmsg.searchResetText,iconCls:"reset",listeners:{scope:this,click:this._resetForm}});this.buttons=[this.searchBtn,this.resetBtn];Ext.whaty.ux.form.BaseSearchForm.superclass.initComponent.call(this);this.addEvents("search");this.keys=[{key:Ext.EventObject.ENTER,fn:this._doSearch,scope:this}]},_doSearch:function(){var values=this.getSearchFormValue();if(values!=null){this.fireEvent("search",values)}},getSearchFormValue:function(){var form=this.getForm();if(form.isValid()){var returnObj=form.getValues();this._filterFormValues(returnObj);var cbs=this.findByType("combo");for(var i=0;i<cbs.length;i++){if(!ExtUtil.isEmpty(cbs[i].name)){returnObj[cbs[i].name]=cbs[i].getRawValue()}if(!ExtUtil.isEmpty(cbs[i].hiddenName)){returnObj[cbs[i].hiddenName]=cbs[i].getValue()}}var wcbs=this.findByType("whatycombobox");for(var i=0;i<wcbs.length;i++){var wcb=wcbs[i];if(wcb.ck){if(!ExtUtil.isEmpty(cbs[i].name)){returnObj[wcb.name]=wcb.selectedTexts.join(",")}if(!ExtUtil.isEmpty(cbs[i].hiddenName)){returnObj[wcb.hiddenName]=wcb.selectedValues.join(",")}}else{if(!ExtUtil.isEmpty(cbs[i].name)){returnObj[wcb.name]=wcb.getRawValue()}if(!ExtUtil.isEmpty(cbs[i].hiddenName)){returnObj[wcb.hiddenName]=wcb.getValue()}}}return returnObj}else{return null}},_resetForm:function(){this.getForm().reset()}});Ext.namespace("Ext.whaty.ux.grid.*");Ext.whaty.ux.grid.QueryPageGrid=Ext.extend(Ext.grid.EditorGridPanel,{baselocalmsg:{msgTitle:"Message",dataLoadFailure:"Load Data Failure",noDataMsg:"No Data"},ck:true,ckSingleSelect:false,rownum:false,cmField:[],attrField:[],loadMask:{msg:"Loading..."},timeout:1000,proxyUrl:"",pageSize:25,proxyAutoLoad:true,pageBarItems:[],extraParam:{},queryParam:null,sortField:"id",direction:"ASC",idDataIndex:"id",autoRenderer:false,pagingBar:true,initComponent:function(){var cmFields=this.cmField;if(cmFields!=null&&cmFields.length>0){if(this.attrField.length==1&&this.attrField[0].name==this.idDataIndex&&cmFields[0].dataIndex==this.idDataIndex){this.attrField.pop()}for(var i=0;i<cmFields.length;i++){var field=cmFields[i];this.attrField.push({name:field.dataIndex});if(this.autoRenderer&&field.renderer==undefined){field.renderer=this.handleAutoRenderer}}}if(this.ck){this.sm=new Ext.grid.CheckboxSelectionModel({singleSelect:this.ckSingleSelect});this.cmField.unshift(this.sm)}if(this.rownum){this.cmField.unshift(new Ext.grid.RowNumberer())}this.cm=new Ext.grid.ColumnModel(this.cmField);this.store=new Ext.whaty.ux.grid.PageStore({proxy:new Ext.data.HttpProxy({url:this.proxyUrl}),reader:new Ext.data.JsonReader({totalProperty:"totalCount",root:"root"},this.attrField),sortInfo:{field:this.sortField,direction:this.direction},remoteSort:true,listeners:{scope:this,exception:function(misc){ExtUtil.alert(this.baselocalmsg.msgTitle,this.baselocalmsg.dataLoadFailure,this.timeout);this.store.removeAll()},load:function(store,records,options){var jsonData=store.reader.jsonData;if(jsonData.root.length!=undefined){if(jsonData.totalCount==0){ExtUtil.alert(this.baselocalmsg.msgTitle,this.baselocalmsg.noDataMsg,this.timeout)}}else{ExtUtil.alert(this.baselocalmsg.msgTitle,this.baselocalmsg.dataLoadFailure,this.timeout)}}}});var pageNumbar=this._createPageSize();if(this.pagingBar){this.bbar=new Ext.PagingToolbar({pageSize:this.pageSize,store:this.store,displayInfo:true,items:["-",pageNumbar,this.pageBarItems]})}Ext.whaty.ux.grid.QueryPageGrid.superclass.initComponent.call(this);if(this.proxyAutoLoad&&this.proxyUrl!=null){this._initStore()}},_initStore:function(){var _extraParam=Ext.util.JSON.encode(this.extraParam);this.store.setQueryParam({extraParam:_extraParam});this.store.load({params:{start:0,limit:this.pageSize}})},reload:function(queryParam){var _extraParam=Ext.util.JSON.encode(this.extraParam);if(queryParam==null||queryParam==undefined){queryParam=new Object()}queryParam.extraParam=_extraParam;this.store.setQueryParam(queryParam);var _start=0;if(this.store.lastOptions!=undefined&&this.store.lastOptions!=null){_start=this.store.lastOptions.params.start}this.store.reload({params:{start:_start,limit:this.pageSize}})},_createPageSize:function(){this.psTF=new Ext.form.ComboBox({store:new Ext.data.SimpleStore({fields:["value","text"],data:[[10,"10"],[25,"25"],[50,"50"],[100,"100"]]}),value:this.pageSize,readOnly:true,valueField:"value",displayField:"text",forceSelection:true,mode:"local",triggerAction:"all",width:60,listeners:{scope:this,select:function(cb,record){var value=record.get("value");this.bottomToolbar.pageSize=value;this.pageSize=value;this.reload(this.queryParam)}}});return this.psTF},getSelectedRecord:function(){return this.getSelectionModel().getSelected()},getSelectedRecordId:function(){var record=this.getSelectedRecord();return record==null?null:record.get(this.idDataIndex)},getSelectedRecordValue:function(key){if(key==undefined||key==null){alert("key is not allowd null")}else{var record=this.getSelectedRecord();return record==null?null:record.get(key)}},getSelectedRecordData:function(){var record=this.getSelectedRecord();return record==null?null:record.data},getSelectedRecords:function(){return this.getSelectionModel().getSelections()},getSelectedRecordValues:function(key,isString){if(key==undefined||key==null){alert("key is not allowd null")}else{var records=this.getSelectedRecords();if(records!=null&&records.length>0){var ids=[];for(var i=0;i<records.length;i++){ids.push(records[i].get(key))}if(isString!=undefined&&isString){return ids.join(",")}else{return ids}}else{return null}}},getSelectedRecordIds:function(isString){return this.getSelectedRecordValues(this.idDataIndex,isString)},removeAllRecords:function(){this.store.removeAll();this.store.commitChanges()},removeRecordAt:function(index){if(index!=null&&index!=undefined&&typeof index=="number"){this.store.removeAt(index);this.store.commitChanges()}},handleAutoRenderer:function(value,metadata,record,rowIndex,columnIndex,store){return value}});Ext.whaty.ux.grid.PageStore=Ext.extend(Ext.data.Store,{load:function(options){options=options||{};this.storeOptions(options);if(this.sortInfo&&this.remoteSort){var pn=this.paramNames;options.params=options.params||{};options.params[pn.sort]=this.sortInfo.field;options.params[pn.dir]=this.sortInfo.direction}if(this.queryParam!=null){for(var p in this.queryParam){if(this.queryParam[p]!=null&&this.queryParam[p]!=""){options.params[p]=this.queryParam[p]}}}try{return this.execute("read",null,options)}catch(e){this.handleException(e);return false}},setQueryParam:function(param){if(param&&typeof param=="object"){if(this.queryParam==undefined||this.queryParam==null){this.queryParam={}}for(var p in param){this.queryParam[p]=param[p]}}}});Ext.whaty.ux.grid.GridImportWindow=Ext.extend(Ext.Window,{localmsg:{titleText:"Attach Upload",fileLabelText:"File",uploadBtnText:"Upload",templateDownloadText:"Download Template",btnCancelText:"Cancel",msgTitle:"Message",importExecelFailure:"Can Not Import Excel",filePathBlank:"File Path Is Required",uploadFailure:"Upload Failure",updateDataEmpty:"The Update Data IS Required",correctFileType:"Please Choose Correct File Format"},gridId:"",className:null,upColumns:[],keyColumn:"id",keyColumnIndex:0,filter:[],width:510,height:150,modal:true,resizable:false,layout:"fit",buttonAlign:"center",initComponent:function(){this.title=this.localmsg.titleText;this.uploadField=new Ext.form.TextField({fieldLabel:this.localmsg.fileLabelText,id:"ImportExcelFile",inputType:"file",anchor:"100%",height:23});this.uploadBtn=new Ext.Button({text:this.localmsg.uploadBtnText,iconCls:"uploadAttach",style:{marginTop:"1px"},listeners:{scope:this,click:this._submit}});var downLoadUrl='<a href="'+CONTEXT_PATH+'/resource/template/record.xls">'+this.localmsg.templateDownloadText+"</a>";this.uploadForm=new Ext.form.FormPanel({frame:true,labelAlign:"right",layout:"form",items:[{layout:"column",items:[{width:400,layout:"form",items:this.uploadField},{width:50,layout:"form",items:this.uploadBtn}]},{layout:"column",items:[{width:70,layout:"form",items:null},{layout:"form",items:{html:downLoadUrl}}]}]});this.items=this.uploadForm;this.buttons=[{text:this.localmsg.btnCancelText,iconCls:"cancel",scope:this,handler:this._cancel}];Ext.whaty.ux.grid.GridImportWindow.superclass.initComponent.call(this);this.addEvents("importsuccess")},_submit:function(){if(this.className==null){Ext.MessageBox.alert(this.localmsg.msgTitle,this.localmsg.importExecelFailure);return}if(this.uploadField.getValue()==""){Ext.MessageBox.alert(this.localmsg.msgTitle,this.localmsg.filePathBlank);return}else{var flag=true;var fullFilename=this.uploadField.getValue();fullFilename=fullFilename.replace(new RegExp("\\\\","gm"),"/");var fileNameIndex=fullFilename.lastIndexOf("/");var fileName=fullFilename.substr(fileNameIndex+1);var index=fileName.lastIndexOf(".");var fileType=fileName.substr(index);if(this.filter.length>0){for(var i=0;i<this.filter.length;i++){if(this.filter[i]==fileType){flag=true;break}}}else{flag=true}if(flag){var file=dwr.util.getValue("ImportExcelFile");var upColumns=this.upColumns;var className=this.className;var keyColumn=this.keyColumn;var keyColumnIndex=this.keyColumnIndex;var map={className:className,keyColumn:keyColumn,keyColumnIndex:keyColumnIndex,filename:fileName};var _this=this;var _window=window;DwrExcelUtil.importExcelData(map,upColumns,file,function(result){if(result=="success"){_this.close();_this._reloadGrid()}else{if(result=="failure"){ExtUtil.alert(this.localmsg.msgTitle,this.localmsg.uploadFailure,1200)}else{ExtUtil.alert(this.localmsg.msgTitle,this.localmsg.updateDataEmpty,1200)}}})}else{ExtUtil.alert(this.localmsg.msgTitle,this.localmsg.correctFileType+"["+this.filter.join(",")+"]",1200)}}},_reloadGrid:function(){var grid=Ext.getCmp(this.gridId);grid.reload()},_cancel:function(){this.close()}});Ext.whaty.ux.grid.GridWindowForm=Ext.extend(Ext.Window,{localmsg:{saveText:"Save",resetText:"Reset",cancelText:"Cancel",loadRecordFailureText:"Load Record Failure",msgTitle:"Message",maskInfoText:"Saving...",saveSuccessText:"Save Success",saveFailureText:"Save Failure"},timeout:1200,actiontype:"add",allowSave:true,gridId:null,BeanForm:null,proxyReadUrl:null,proxyAndUrl:null,proxyUpdateUrl:null,forceLayout:true,closeAction:"hide",modal:true,autoScroll:true,buttonAlign:"center",myButtons:[],initComponent:function(){this.saveBtn=new Ext.Button({text:this.localmsg.saveText,iconCls:"save",listeners:{scope:this,click:this._mergeEntityBean}});this.resetBtn=new Ext.Button({text:this.localmsg.resetText,iconCls:"reset",listeners:{scope:this,click:this._resetForm}});this.cancelBtn=new Ext.Button({text:this.localmsg.cancelText,iconCls:"cancel",listeners:{scope:this,click:this._cancel}});if(this.BeanForm!=null){this.items=[this.BeanForm]}if(this.allowSave){this.buttons=[this.saveBtn,this.cancelBtn]}else{this.buttons=[this.cancelBtn]}for(var i=0;i<this.myButtons.length;i++){this.buttons.push(this.myButtons[i])}Ext.whaty.ux.grid.GridWindowForm.superclass.initComponent.call(this);this.on("hide",this._executeHide,this);this.keys=[{key:Ext.EventObject.ENTER,fn:this._mergeEntityBean,scope:this}];this.addEvents("mergeSuccess")},showWindow:function(gridId,type,id){this.gridId=gridId;this.actionType=type;switch(type){case"add":this.actiontype="add";this.show();this._resetForm();break;case"read":this.actiontype="read";this._doReadBean(id);break;case"update":this.actiontype="update";this._doReadBean(id);break}},_doReadBean:function(id){var bean=this._getEntityBean(id);if(bean!=null){this.show();this.BeanForm.loadFormValue(bean)}},_getEntityBean:function(id){var bean=null;Ext.Ajax.request({async:false,params:{entityId:id},method:"POST",scope:this,url:this.proxyReadUrl,success:function(response,opts){if(response.responseJSON==undefined){response.responseJSON=Ext.util.JSON.decode(response.responseText)}var logicSuccess=response.responseJSON.logicSuccess;var msg=response.responseJSON.msg;if(logicSuccess){bean=response.responseJSON}else{if(msg==undefined||msg==null||msg==""){msg=this.localmsg.loadRecordFailureText}ExtUtil.alert(this.localmsg.msgTitle,msg,this.timeout)}},failure:function(response,opts){ExtUtil.alert(this.localmsg.msgTitle,this.localmsg.loadRecordFailureText,this.timeout)}});return bean},_mergeEntityBean:function(){var url=this.proxyAndUrl;if(this.actiontype=="read"){this.hide();return}if(this.actiontype=="update"){url=this.proxyUpdateUrl}if(this.BeanForm!=null){this.BeanForm.setExtraParams();var _params=this.BeanForm.extraParams;if(_params==null||_params==undefined){_params=new Object()}_params.actionType=this.actiontype;var form=this.BeanForm.getForm();if(form.isValid()){this.getEl().mask(this.localmsg.maskInfoText,"x-mask-loading");if(this.BeanForm.setComboboxHiddenValue!=undefined){var arr=this.BeanForm.setComboboxHiddenValue();if(arr!=null&&arr.length>0){for(var i=0;i<arr.length;i++){var vObj=arr[i];for(var p in vObj){_params[p]=vObj[p]}}}}form.submit({params:_params,scope:this,url:url,success:function(form,action){var response=action.response;if(response.responseJSON==undefined){response.responseJSON=Ext.util.JSON.decode(response.responseText)}var logicSuccess=response.responseJSON.logicSuccess;var msg=response.responseJSON.msg;if(logicSuccess){if(msg==undefined||msg==null||msg==""){msg=this.localmsg.saveSuccessText}ExtUtil.alert(this.localmsg.msgTitle,msg,this.timeout);Ext.getCmp(this.gridId).reload(null);this.hide();var entityBean=response.responseJSON.entityBean;this.fireEvent("mergeSuccess",entityBean)}else{if(msg==undefined||msg==null||msg==""){msg=this.localmsg.saveFailureText}ExtUtil.alert(this.localmsg.msgTitle,msg,this.timeout)}this.getEl().mask().remove();if(this.BeanForm.setComboboxText!=undefined){this.BeanForm.setComboboxText()}},failure:function(){this.getEl().mask().remove();ExtUtil.alert(this.localmsg.msgTitle,this.localmsg.saveFailureText,this.timeout);if(this.BeanForm.setComboboxText!=undefined){this.BeanForm.setComboboxText()}}})}}},_resetForm:function(){if(this.BeanForm!=null){this.BeanForm.getForm().reset()}},_cancel:function(){this.hide()},setSaveButtonVisible:function(visible){this.saveBtn.setVisible(visible)},setProxyReadUrl:function(url){this.proxyReadUrl=url},setProxyAndUrl:function(url){this.proxyAndUrl=url},setProxyUpdateUrl:function(url){this.proxyUpdateUrl=url},_executeHide:function(win){if(this.BeanForm.resetForm){this.BeanForm.resetForm()}}});Ext.whaty.ux.grid.GridSearchForm=Ext.extend(Ext.whaty.ux.form.BaseSearchForm,{title:"&nbsp;",formConfig:{},gridId:null,collapsible:true,collapsed:false,animCollapse:false,beanPrefixName:"searchBean",fieldItems:[],colNum:4,maxHeight:200,initComponent:function(){if(this.formConfig.colNum!=undefined){this.colNum=this.formConfig.colNum}if(this.formConfig.beanPrefixName!=undefined){this.beanPrefixName=this.formConfig.beanPrefixName}this.CONTAINER_WIDTH=FrameWorkHelper.getContainerInnerWidth()-50;var itemWidth=this.CONTAINER_WIDTH/this.colNum-5;if(this.fieldItems!=null&&this.fieldItems.length>0){this.items=this.initFormItems(itemWidth)}this.initFormConfig();Ext.whaty.ux.grid.GridSearchForm.superclass.initComponent.call(this)},initFormConfig:function(){if(this.formConfig.title!=undefined){this.title=this.formConfig.title}if(this.formConfig.region!=undefined){this.region=this.formConfig.region}if(this.formConfig.height!=undefined){this.height=this.formConfig.height}else{var itemLength=this.items.length;var height=105+itemLength*20;if(height>165){height=165}this.height=height}Ext.applyIf(this,this.formConfig)},initFormItems:function(itemWidth){var rstItems=[];var tmpItems=[];var j=0;for(var i=0;i<this.fieldItems.length;i++){var field=this.fieldItems[i];if(field.fieldtype!=undefined&&field.fieldtype!=null&&field.fieldtype!=""&&field.fieldtype!="hidden"){var obj=new Object();if(field.fieldAttr!=undefined&&field.fieldAttr.searchAble){var _fieldType=field.fieldtype;if(_fieldType=="whatycombobox"){var tmpObj=this._createCombobox(field);if(tmpObj!=null){obj=tmpObj}else{_fieldType="textfield"}}else{if(_fieldType=="textarea"||_fieldType=="ckeditor"||_fieldType=="ckeditor"||_fieldType=="radiogroup"||_fieldType=="checkboxgroup"){_fieldType="textfield"}}obj.xtype=_fieldType;obj.name=this._getFiledName(field.dataIndex);obj.fieldLabel=field.header;obj.anchor="100%";if(field.fieldAttr!=undefined){Ext.applyIf(obj,field.fieldAttr);if(field.fieldAttr.id!=undefined){obj.id="Search-"+field.fieldAttr.id}}if(field.fieldAttr.regex!=undefined){obj.regex=field.fieldAttr.regex;obj.regexText=field.fieldAttr.regexText==undefined?field.header+this.localmsg.invalidText:field.fieldAttr.regexText}obj.allowBlank=true;obj.value=null;if((j+1)%this.colNum==0){tmpItems.push(obj);rstItems.push(this._createColumnCmp(tmpItems,itemWidth));tmpItems=new Array()}else{tmpItems.push(obj)}j++}}}if(tmpItems.length>0){rstItems.push(this._createColumnCmp(tmpItems,itemWidth))}return rstItems},_createColumnCmp:function(items,itemWidth){var _items=[];for(var i=0;i<items.length;i++){_items.push({width:itemWidth,layout:"form",items:items[i]})}return{layout:"column",width:this.CONTAINER_WIDTH,items:_items}},_doSearch:function(){var form=this.getForm();if(form.isValid()){var values=this.getFormValue();if(values!=null){if(this.gridId!=null){var grid=Ext.getCmp(this.gridId);grid.reload(values)}}}},_createCombobox:function(field){var url=field.fieldAttr.url;var jsonData=field.fieldAttr.jsonData;if(url==undefined){url=null;if(jsonData==undefined){alert("请赋值url,或者 jsonData");return null}}var _hiddenName=field.fieldAttr.hiddenName;if(_hiddenName!=undefined&&_hiddenName!=""){_hiddenName=this._getFiledName(_hiddenName)}else{alert("请在fieldAttr中添加hiddenName属性");return null}var _value=field.fieldAttr.value;var displayField="text";var valueField="value";if(field.fieldAttr.displayField!=undefined&&field.fieldAttr.displayField!=""){displayField=field.fieldAttr.displayField}if(field.fieldAttr.valueField!=undefined&&field.fieldAttr.valueField!=""){valueField=field.fieldAttr.valueField}var autoSearch=true;if(field.fieldAttr.autoSearch!=undefined){autoSearch=field.fieldAttr.autoSearch}var _searchWhatyCombobox=new Object({cbtype:"search",xtype:"whatycombobox",proxyUrl:url,ck:false,displayField:displayField,valueField:valueField,jsonData:jsonData,value:_value,hiddenName:_hiddenName,anchor:"100%"});if(autoSearch){if(field.fieldAttr.listeners==undefined){_searchWhatyCombobox.listeners={scope:this,select:this.comboboxValueSelected}}else{var form=this;_searchWhatyCombobox.listeners=field.fieldAttr.listeners;if(field.fieldAttr.listeners.select==undefined){_searchWhatyCombobox.listeners.select=function(cb,record,index){form.comboboxValueSelected()}}else{var selectFun=field.fieldAttr.listeners.select;_searchWhatyCombobox.listeners.select=selectFun.createSequence(function(){form.comboboxValueSelected()})}}}if(field.fieldAttr.pageSize!=undefined){_searchWhatyCombobox.pageSize=field.fieldAttr.pageSize}Ext.applyIf(_searchWhatyCombobox,field.fieldAttr);return _searchWhatyCombobox},_getFiledName:function(name){return this.beanPrefixName+"."+name},comboboxValueSelected:function(cb,record,index){if(cb.cbtype=="search"){var values=this.getSearchFormValue();if(values!=null){this.fireEvent("search",values)}}}});Ext.namespace("Ext.whaty.ux.grid.*");Ext.whaty.ux.grid.LogicQueryPageGrid=Ext.extend(Ext.whaty.ux.grid.QueryPageGrid,{cmpType:"LogicQueryPageGrid",localmsg:{addBtnText:"Add",updateBtnText:"Edit",deleteBtnText:"Delete",searchBtnText:"Search",exportColsTipText:"Export All Columns",currentPageText:"Current Page Records",allRecordText:"All Records",excelEmptyText:"Export Excel Style",excelUploadText:"Upload",msgTitle:"Message",editRecordMsgText:"Please Choose Record",sureDeleteInfo:"Are You Sure To Delete Records ?",deleteSuccessText:"Delete Success",deleteFailureText:"Delete Failure",deleteRecordMsgText:"Please Choose Record",sureExportCurrentText:"Are You Sure To Export Current Page Records (xls)",sureExportAllText:"Are You Sure To Export All Records (xls)",exportFailureText:"Export Excel Failure ! Please Try Again..."},allowAddId:null,allowUpdateId:null,allowDeleteId:null,allowImportId:null,allowExportCkId:null,allowExportComboxId:null,allowSearchInputId:null,allowSearchButtonId:null,timeout:1200,typical:false,ActionUrl:"",proxyReadUrl:null,proxyAddUrl:null,proxyUpdateUrl:null,proxyDeleteUrl:null,searchByBean:false,allowSearchForm:false,searchFormConfig:{},SearchForm:null,BeanWindowForm:null,beanPrefixName:null,beanWindowFormConfig:{resizable:true,width:420,height:300,title:" ",buttons:[]},beanWindowFormTitle:" ",idWidth:50,idHidden:true,idHeader:"ID",allowAdd:true,allowUpdate:false,allowDelete:true,allowRead:true,allowSave:true,allowImport:false,allowExport:false,allowSearch:false,searchFieldName:"GridSearchField",searchToolTip:{},saveButton:true,importExcelButton:false,className:null,excelAllUpdate:true,exportExcel:false,excelFileName:"record.xls",keyColumn:"id",keyColumnIndex:1,toolbar:[],pagebar:[],initComponent:function(){this.addButtonText=this.localmsg.addBtnText;this.updateButtonText=this.localmsg.updateBtnText;this.deleteButtonText=this.localmsg.deleteBtnText;this.cmField.unshift({header:this.idHeader,dataIndex:this.idDataIndex,fieldtype:"hidden",width:this.idWidth,hidden:this.idHidden});this.attrField=[{name:this.idDataIndex}];if(this.proxyUrl==null||this.proxyUrl==""){if(this.allowSearchForm||this.searchByBean){this.proxyUrl=CONTEXT_PATH+this.ActionUrl+"_extPagingQueryBean.action"}else{this.proxyUrl=CONTEXT_PATH+this.ActionUrl+"_extPagingQueryObject.action"}}if(this.allowExport||this.exportExcel){this.excelCK=new Ext.whaty.ux.grid.FwCheckbox({hideLabel:true,id:this.allowExportCkId,tooltip:{text:this.localmsg.exportColsTipText}});var _excelData=[["CURRENT",this.localmsg.currentPageText],["ALL",this.localmsg.allRecordText]];this.excelTF=new Ext.form.ComboBox({id:this.allowExportComboxId,emptyText:this.localmsg.excelEmptyText,store:new Ext.data.SimpleStore({fields:["value","text"],data:_excelData}),readOnly:true,valueField:"value",displayField:"text",forceSelection:true,mode:"local",triggerAction:"all",listeners:{scope:this,select:this._excelExport}});this.pageBarItems=["-",this.excelCK,this.excelTF]}if(this.pagebar!=null&&this.pagebar.length>0){this.pageBarItems.push("-");this.pageBarItems.push(this.pagebar)}this.extraParam.exportExcel=this.exportExcel||this.allowExport;this.extraParam.allowSearchForm=this.allowSearchForm;this.excelImportBtn=new Ext.Button({text:this.localmsg.excelUploadText,iconCls:"excelupload",id:this.allowImportId,listeners:{scope:this,click:this._excelImport}});var _tbar=this._initToolbar();if(_tbar!=null&&_tbar.length>0){this.tbar=[_tbar]}if(this.typical){this._initTypicalGrid()}else{this._initCustomGrid()}Ext.whaty.ux.grid.LogicQueryPageGrid.superclass.initComponent.call(this);this.selModel.on("rowselect",this.selModelRowSelectedOrNot,this);this.selModel.on("rowdeselect",this.selModelRowSelectedOrNot,this)},_initTypicalGrid:function(){this.addEvents("read","add","update","delete");if(this.allowRead){this.on("rowdblclick",this._readEntityBean,this)}},_initCustomGrid:function(){if(this.allowRead){this.on("rowdblclick",this._readEntityBean,this)}if(this.allowSearchForm){this._createSearchForm()}this.on("afterrender",this.afterRenderGrid,this);this.addEvents("beforeDelete","afterDelete","afterMerge")},afterRenderGrid:function(){this._createWindowForm()},_createSearchForm:function(){if(this.SearchForm==null){this.SearchForm=new Ext.whaty.ux.grid.GridSearchForm({collapsible:true,collapsed:false,animCollapse:false,region:"north",fieldItems:this.cmField,formConfig:this.searchFormConfig,listeners:{scope:this,search:function(values){this.reload(values)}}})}},_createWindowForm:function(){if(this.BeanWindowForm==null){var _title=this.beanWindowFormConfig.title!=undefined?this.beanWindowFormConfig.title:" ";var _width=this.beanWindowFormConfig.width!=undefined?this.beanWindowFormConfig.width:420;var _height=this.beanWindowFormConfig.height!=undefined?this.beanWindowFormConfig.height:300;var _resizable=this.beanWindowFormConfig.resizable!=undefined?this.beanWindowFormConfig.resizable:true;var _buttons=this.beanWindowFormConfig.buttons!=undefined?this.beanWindowFormConfig.buttons:[];this.BeanWindowForm=new Ext.whaty.ux.grid.GridWindowForm({title:_title,width:_width,height:_height,resizable:_resizable,timeout:this.timeout,myButtons:_buttons,forceLayout:true,allowSave:this.allowSave,layout:"border",BeanForm:new Ext.whaty.ux.form.LogicBaseForm({beanPrefixName:this.beanPrefixName,fieldItems:this.cmField,region:"center"}),listeners:{scope:this,mergeSuccess:function(entityBean){this.fireEvent("afterMerge",entityBean)}}})}},_initToolbar:function(){var _tbar=[];if(this.allowAdd){this.addBtn=new Ext.Button({id:this.allowAddId,text:this.addButtonText,iconCls:"add",listeners:{scope:this,click:this._addEntityBean}});_tbar.push(this.addBtn)}if(this.allowUpdate){this.updateBtn=new Ext.Button({id:this.allowUpdateId,text:this.updateButtonText,iconCls:"update",disabled:true,listeners:{scope:this,click:this._updateEntityBean}});_tbar.push(this.updateBtn)}if(this.allowDelete){this.deleteBtn=new Ext.Button({id:this.allowDeleteId,text:this.deleteButtonText,iconCls:"delete",disabled:true,listeners:{scope:this,click:this._deleteEntityBean}});_tbar.push(this.deleteBtn)}if(this.toolbar!=null&&this.toolbar.length>0){for(var i=0;i<this.toolbar.length;i++){_tbar.push(this.toolbar[i])}}if(this.allowImport||this.importExcelButton){_tbar.push(this.excelImportBtn)}if(this.allowSearch){_tbar.push("->");this.searchInput=new Ext.whaty.ux.form.WhatyTextField({id:this.allowSearchInputId,hideLabel:true,tooltip:this.searchToolTip});this.searchBtn=new Ext.Button({id:this.allowSearchButtonId,iconCls:"query",tooltip:this.localmsg.searchBtnText,listeners:{scope:this,click:this._doSearch}});_tbar.push(this.searchInput);_tbar.push(this.searchBtn);this.keys=[{key:Ext.EventObject.ENTER,fn:this._doSearch,scope:this}]}return _tbar},_doSearch:function(){var param=new Object();if(this.searchFieldName==""||this.searchFieldName==undefined||this.searchFieldName==null){this.searchFieldName="GridSearchField"}param[this.searchFieldName]=this.searchInput.getValue();this.reload(param)},_readEntityBean:function(grid){if(this.typical){this.fireEvent("read")}else{if(this.BeanWindowForm!=null){var flag=this.beforeFormWindowShow();if(flag){if(this.BeanWindowForm.showWindow==undefined){this.BeanWindowForm.show()}else{this._setBeanWindowFormActionUrl();var record=grid.getSelectionModel().getSelected();if(record!=null&&record!=undefined){var id=record.get(this.idDataIndex);this.BeanWindowForm.showWindow(this.getId(),"update",id)}}this.afterFormWindowShow()}}}},readEntityBean:function(id){if(this.BeanWindowForm!=null){if(this.BeanWindowForm.showWindow==undefined){this.BeanWindowForm.show()}else{this.BeanWindowForm.showWindow(this.getId(),"update",id)}}},beforeFormWindowShow:function(){return true},afterFormWindowShow:function(){},_addEntityBean:function(){if(this.typical){this.fireEvent("add")}else{if(this.BeanWindowForm!=null){var flag=this.beforeFormWindowShow();if(flag){if(this.BeanWindowForm.showWindow==undefined){this.BeanWindowForm.show()}else{this._setBeanWindowFormActionUrl();this.BeanWindowForm.showWindow(this.getId(),"add",null)}this.afterFormWindowShow()}}}},_updateEntityBean:function(){if(this.typical){this.fireEvent("add")}else{var record=this.getSelectionModel().getSelected();if(record==null){ExtUtil.alert(this.localmsg.msgTitle,this.localmsg.editRecordMsgText,this.timeout)}else{var id=record.get(this.idDataIndex);if(this.BeanWindowForm!=null){if(this.BeanWindowForm.showWindow==undefined){this.BeanWindowForm.show()}else{this._setBeanWindowFormActionUrl();var id=record.get(this.idDataIndex);this.BeanWindowForm.showWindow(this.getId(),"update",id)}}}}},_setBeanWindowFormActionUrl:function(){var readUrl=CONTEXT_PATH+this.ActionUrl+"_extGetById.action";if(this.proxyReadUrl!=null&&this.proxyReadUrl!=""){readUrl=this.proxyReadUrl}this.BeanWindowForm.setProxyReadUrl(readUrl);var addUrl=CONTEXT_PATH+this.ActionUrl+"_extMergeEntity.action";if(this.proxyAddUrl!=null&&this.proxyAddUrl!=""){addUrl=this.proxyAddUrl}this.BeanWindowForm.setProxyAndUrl(addUrl);var updateUrl=CONTEXT_PATH+this.ActionUrl+"_extMergeEntity.action";if(this.proxyUpdateUrl!=null&&this.proxyUpdateUrl!=""){updateUrl=this.proxyUpdateUrl}this.BeanWindowForm.setProxyUpdateUrl(updateUrl)},_deleteEntityBean:function(){if(this.typical){this.fireEvent("delete",ids)}else{if(!this.fireEvent("beforeDelete")){return}var delUrl=CONTEXT_PATH+this.ActionUrl+"_extDeleteByIds.action";if(this.proxyDeleteUrl!=null&&this.proxyDeleteUrl!=""){delUrl=this.proxyDeleteUrl}var records=this.getSelectionModel().getSelections();if(records!=null&&records.length>0){var ids=[];for(var i=0;i<records.length;i++){ids.push(records[i].get(this.idDataIndex))}Ext.MessageBox.confirm(this.localmsg.msgTitle,this.localmsg.sureDeleteInfo,function(btn){if(btn=="yes"){Ext.Ajax.request({params:{entityIds:ids.join(",")},method:"POST",scope:this,url:delUrl,success:function(response,opts){if(response.responseJSON==undefined){response.responseJSON=Ext.util.JSON.decode(response.responseText)}var logicSuccess=response.responseJSON.logicSuccess;var msg=response.responseJSON.msg;if(logicSuccess){if(msg==undefined||msg==null||msg==""){msg=this.localmsg.deleteSuccessText}ExtUtil.alert(this.localmsg.msgTitle,msg,this.timeout);this.reload(null);this.fireEvent("afterDelete",ids)}else{if(msg==undefined||msg==null||msg==""){msg=this.localmsg.deleteFailureText}ExtUtil.alert(this.localmsg.msgTitle,msg,this.timeout)}},failure:function(response,opts){ExtUtil.alert(this.localmsg.msgTitle,this.localmsg.deleteFailureText,this.timeout)}})}},this)}else{ExtUtil.alert(this.localmsg.msgTitle,this.localmsg.deleteRecordMsgText,this.timeout)}}},_excelImport:function(){if(this.className!=null&&this.className!=""){var columns=[];var cmFields=this.cmField;if(cmFields!=null&&cmFields.length>0){if(this.excelAllUpdate){for(var i=0;i<cmFields.length;i++){var field=cmFields[i];if(field.dataIndex!=""&&field.hidden!=true){columns.push(field.dataIndex)}}}else{for(var i=0;i<cmFields.length;i++){var field=cmFields[i];if(field.dataIndex!=""&&field.hidden!=true&&field.excelUpdate==true){columns.push(field.dataIndex)}}}}var _this=this;var win=new Ext.whaty.ux.grid.GridImportWindow({className:this.className,gridId:this.id,keyColumn:this.keyColumn,keyColumnIndex:this.keyColumnIndex,upColumns:columns,filter:[".xls"]});win.show()}else{ExtUtil.alert(this.localmsg.msgTitle,'property "className" is null',this.timeout)}},_excelExport:function(cb,record){var style=record.get("value");var msg=this.localmsg.sureExportCurrentText;if(style=="ALL"){msg=this.localmsg.sureExportAllText}Ext.MessageBox.confirm(this.localmsg.msgTitle,msg,function(btn){if(btn=="yes"){var param=new Object();var queryParams=this.store.reader.jsonData.queryParams;if(queryParams!=undefined){for(property in queryParams){if(property=="values"){param[property]=Ext.util.JSON.encode(queryParams[property])}else{param[property]=queryParams[property]}}}else{param.queryType="bean"}param.pageSize=this.pageSize;param.pageNo=this.getBottomToolbar().getPageData().activePage;param.excelFileName=this.excelFileName;var indexs=[];var headers=[];var cmFields=this.cmField;if(cmFields!=null&&cmFields.length>0){if(this.excelCK.getValue()){for(var i=0;i<cmFields.length;i++){var field=cmFields[i];if(field.dataIndex!=""){indexs.push(field.dataIndex);headers.push(field.header)}}}else{for(var i=0;i<cmFields.length;i++){var field=cmFields[i];if(field.dataIndex!=""&&field.hidden!=true){indexs.push(field.dataIndex);headers.push(field.header)}}}}if(DwrExcelUtil!=undefined&&DwrExcelUtil!=null){DwrExcelUtil.exportExcelData(style,param,indexs,headers,function(result){if(result==null){ExtUtil.alert(this.localmsg.msgTitle,this.localmsg.exportFailureText,this.timeout)}else{dwr.engine.openInDownload(result)}})}}},this)},loadContainerPanel:function(param,reload){try{var fwv=Ext.getCmp("WhatyFrameWorkViewport");if(fwv!=null&&fwv!=undefined){if(reload){fwv.reloadContainerPanel(param)}else{fwv.loadContainerPanel(param)}}else{if(reload){fwv.reloadContainerPanel(param)}else{parent.ExtUtil.loadContainerPanel(param)}}}catch(error){alert("WhatyFrameWorkViewport is not defined")}},selModelRowSelectedOrNot:function(selModel,rowIndex,record){var selectedRecords=this.getSelectedRecords();if(selectedRecords!=null&&selectedRecords.length>0){if(this.allowUpdate){if(selectedRecords.length==1){this.updateBtn.setDisabled(false)}else{this.updateBtn.setDisabled(true)}}if(this.allowDelete){this.deleteBtn.setDisabled(false)}}else{if(this.allowUpdate){this.updateBtn.setDisabled(true)}if(this.allowDelete){this.deleteBtn.setDisabled(true)}}},getFormWindowActionType:function(){if(this.BeanWindowForm!=null){return this.BeanWindowForm.actiontype}return null},getFormWindow:function(){return this.BeanWindowForm},getToolbarIds:function(){return this.getOptIds()},getOptIds:function(){var optIds=[];if(this.allowAddId!=null){optIds.push(this.allowAddId)}if(this.allowUpdateId!=null){optIds.push(this.allowUpdateId)}if(this.allowDeleteId!=null){optIds.push(this.allowDeleteId)}if(this.allowImportId!=null){optIds.push(this.allowImportId)}if(this.allowExportCkId!=null){optIds.push(this.allowExportCkId)}if(this.allowExportComboxId!=null){optIds.push(this.allowExportComboxId)}if(this.allowSearchInputId!=null){optIds.push(this.allowSearchInputId)}if(this.allowSearchButtonId!=null){optIds.push(this.allowSearchButtonId)}if(this.toolbar!=null&&this.toolbar.length>0){for(var i=0;i<this.toolbar.length;i++){var cmp=this.toolbar[i];var cmpId=cmp.id;if(cmpId.indexOf("ext-comp-")==-1){optIds.push(cmpId)}}}return optIds}});Ext.whaty.ux.grid.FwCheckbox=Ext.extend(Ext.form.Checkbox,{style:{width:"20px"},tooltip:{},onRender:function(ct,position){Ext.whaty.ux.grid.FwCheckbox.superclass.onRender.call(this,ct,position);if(this.tooltip.text){new Ext.ToolTip({target:this.id,showDelay:0,dismissDelay:10000,hideDelay:0,trackMouse:true,maxWidth:300,minWidth:100,title:this.tooltip.title,html:this.tooltip.text})}}});Ext.whaty.ux.grid.PageGridPanel=Ext.extend(Ext.whaty.ux.grid.LogicQueryPageGrid,{cmpType:"PageGridPanel",searchByBean:true,initComponent:function(){Ext.whaty.ux.grid.PageGridPanel.superclass.initComponent.call(this)}});Ext.namespace("Ext.whaty.ux.grid.*");Ext.whaty.ux.grid.ExQueryPageGrid=Ext.extend(Ext.whaty.ux.grid.QueryPageGrid,{ck:false,autoRenderer:true,pagingBar:false,border:false,autoHeight:true,enableColumnResize:false,initComponent:function(){Ext.whaty.ux.grid.ExQueryPageGrid.superclass.initComponent.call(this)},handleAutoRenderer:function(value,metadata,record,rowIndex,columnIndex,store){var dataIndex=this.dataIndex;var extraRecordInfo=record.json.extraInfo;if(extraRecordInfo!=undefined){extraInfo=extraRecordInfo[dataIndex];if(extraInfo!=undefined&&Ext.isArray(extraInfo)&&extraInfo.length>0){var cols=record.fields.length;var com_id="ext_expand_"+rowIndex+"_"+columnIndex;var divId=com_id+"_div";var aId=com_id+"_a";var imgId=com_id+"_image";var infoDivId=com_id+"_info_div";var div="<div id='"+divId+"'>";div+="<a id='"+aId+"' href='javascript:void();' onclick='_handleExtraInfoClick(\""+com_id+'","'+rowIndex+'","'+cols+"\");'>";div+="<img id='"+imgId+"' src='"+CONTEXT_PATH+"/resource/ext-3.0.0/resources/images/default/grid/group-expand.gif'/></a>&nbsp;";div+=value;div+="</div>";var extraText="";for(var i=0;i<extraInfo.length;i++){extraText+=extraInfo[i];if(i!=extraInfo.length-1){extraText+="<br/>"}}div+="<div style='display:none;' id='"+infoDivId+"'>"+extraText+"</div>";return div}}return value}});function _handleExtraInfoClick(com_id,rowIndex,cols){var imageSrc=document.getElementById(com_id+"_image").src;if(imageSrc.indexOf("group-collapse")>-1){_setExtraInfoDivDisplay(rowIndex,cols,"none")}else{_setExtraInfoDivDisplay(rowIndex,cols,"inline")}}function _setExtraInfoDivDisplay(rowIndex,cols,display){for(var columnIndex=0;columnIndex<cols;columnIndex++){var com_id="ext_expand_"+rowIndex+"_"+columnIndex;var divEl=document.getElementById(com_id+"_info_div");if(divEl!=undefined&&divEl!=null){if(display=="none"){imageSrc=CONTEXT_PATH+"/resource/ext-3.0.0/resources/images/default/grid/group-expand.gif"}else{imageSrc=CONTEXT_PATH+"/resource/ext-3.0.0/resources/images/default/grid/group-collapse.gif"}document.getElementById(com_id+"_image").src=imageSrc;document.getElementById(com_id+"_info_div").style.display=display}}}Ext.ns("Ext.whaty.ux.grid.*");Ext.whaty.ux.grid.RowSpanView=Ext.extend(Ext.grid.GridView,{constructor:function(conf){Ext.whaty.ux.grid.RowSpanView.superclass.constructor.call(this,conf)},cleanRenderer:function(column,value,metaData,record,rowIndex,colIndex,store){var rowspan=column.rowspan;if(!Ext.isEmpty(rowspan)&&rowspan.length!==0){var recordFront=rowIndex===0?null:store.getAt(rowIndex-1);var isFront=false;for(var i=0;i<rowspan.length;i++){var key=rowspan[i];if(recordFront!=null&&record.get(key)===recordFront.get(key)){isFront=true}else{isFront=false}}if(isFront){return""}}return column.renderer(value,metaData,record,rowIndex,colIndex,store)},doRender:function(cs,rs,ds,startRow,colCount,stripe){var ts=this.templates,ct=ts.cell,rt=ts.row,last=colCount-1;var tstyle="width:"+this.getTotalWidth()+";";var buf=[],cb,c,p={},rp={tstyle:tstyle},r;var cmConfig=this.cm.config,rowspans=[];for(var j=0,len=rs.length;j<len;j++){r=rs[j];cb=[];var rowIndex=(j+startRow);for(var i=0;i<colCount;i++){c=cs[i];p.id=c.id;p.css=i===0?"x-grid3-cell-first ":(i==last?"x-grid3-cell-last ":"");p.attr=p.cellAttr="";p.value=this.cleanRenderer(cmConfig[i],r.data[c.name],p,r,rowIndex,i,ds);p.style=c.style;if(Ext.isEmpty(p.value)){p.value=" "}if(this.markDirty&&r.dirty&&typeof r.modified[c.name]!=="undefined"){p.css+=" x-grid3-dirty-cell"}var rowspan=cmConfig[i].rowspan;var record=r;var recordFront=rowIndex===0?null:ds.getAt(rowIndex-1);var recordLast=rowIndex===ds.getCount()?null:ds.getAt(rowIndex+1);var isFront=false;var isLast=false;if(!Ext.isEmpty(rowspan)&&rowspan.length!==0){for(var k=0;k<rowspan.length;k++){var key=rowspan[k];if(recordFront!=null&&record.get(key)===recordFront.get(key)){isFront=true}else{isFront=false}if(recordLast!=null&&record.get(key)===recordLast.get(key)){isLast=true}else{isLast=false}}if(!isLast){p.css+=" rowspan"}else{p.css+=" rowspan-unborder"}}cb[cb.length]=ct.apply(p)}var alt=[];if(stripe&&((rowIndex+1)%2===0)){alt[0]="x-grid3-row-alt"}if(r.dirty){alt[1]=" x-grid3-dirty-row"}rp.cols=colCount;if(this.getRowClass){alt[2]=this.getRowClass(r,rowIndex,rp,ds)}rp.alt=alt.join(" ");rp.cells=cb.join("");buf[buf.length]=rt.apply(rp)}return buf.join("")}});Ext.ns("Ext.whaty.ux.grid.*");Ext.whaty.ux.grid.RowColSpanView=Ext.extend(Ext.grid.GridView,{autoFill:true,constructor:function(conf){Ext.whaty.ux.grid.RowColSpanView.superclass.constructor.call(this,conf)},cleanRenderer:function(middle,column,value,metaData,record,rowIndex,colIndex,store){var rowspan=column.rowspan;if(!Ext.isEmpty(rowspan)&&rowspan.length!==0){var recordFront=rowIndex===middle?null:store.getAt(rowIndex-1);var isFront=false;for(var i=0;i<rowspan.length;i++){var key=rowspan[i];if(recordFront!=null&&record.get(key)===recordFront.get(key)){isFront=true}else{isFront=false}}if(isFront){return""}}return column.renderer(value,metaData,record,rowIndex,colIndex,store)},doRender:function(cs,rs,ds,startRow,colCount,stripe){var ts=this.templates,ct=ts.cell,rt=ts.row,last=colCount-1;var tstyle="width:"+this.getTotalWidth()+";";var buf=[],cb,c,p={},rp={tstyle:tstyle},r;var cmConfig=this.cm.config,rowspans=[];var middle=Math.round(rs.length/2)-1;for(var j=0,len=rs.length;j<len;j++){r=rs[j];cb=[];var rowIndex=(j+startRow);for(var i=0;i<colCount;i++){c=cs[i];p.id=c.id;p.css=i===0?"x-grid3-cell-first ":(i==last?"x-grid3-cell-last ":"");p.attr=p.cellAttr="";p.value=this.cleanRenderer(middle,cmConfig[i],r.data[c.name],p,r,rowIndex,i,ds);if(middle>0){if(j==0&&cmConfig[i].rowspan){p.value=""}}p.style=c.style;if(Ext.isEmpty(p.value)){p.value=" "}if(this.markDirty&&r.dirty&&typeof r.modified[c.name]!=="undefined"){p.css+=" x-grid3-dirty-cell"}var rowspan=cmConfig[i].rowspan;var record=r;var recordFront=rowIndex===0?null:ds.getAt(rowIndex-1);var recordLast=rowIndex===ds.getCount()?null:ds.getAt(rowIndex+1);var isFront=false;var isLast=false;if(!Ext.isEmpty(rowspan)&&rowspan.length!==0){for(var k=0;k<rowspan.length;k++){var key=rowspan[k];if(recordFront!=null&&record.get(key)===recordFront.get(key)){isFront=true}else{isFront=false}if(recordLast!=null&&record.get(key)===recordLast.get(key)){isLast=true}else{isLast=false}}if(!isLast){p.css+=" rowspan"}else{p.css+=" rowspan-unborder"}}cb[cb.length]=ct.apply(p)}var alt=[];if(stripe&&((rowIndex+1)%2===0)){alt[0]="x-grid3-row-alt"}if(r.dirty){alt[1]=" x-grid3-dirty-row"}rp.cols=colCount;if(this.getRowClass){alt[2]=this.getRowClass(r,rowIndex,rp,ds)}rp.alt=alt.join(" ");rp.cells=cb.join("");buf[buf.length]=rt.apply(rp)}return buf.join("")},renderHeaders:function(){var cm=this.cm,ts=this.templates;var ct=ts.hcell,ct2=ts.mhcell;var cb=[],sb=[],p={},mcb=[];var tmpWidth=this.getTotalWidth();var totalWidth=Number(tmpWidth.substring(0,tmpWidth.lastIndexOf("px")));var _colTotalWidth=0;for(var j=0,len=cm.getColumnCount();j<len;j++){if(cm.config[j].mtext){_colTotalWidth+=cm.config[j].mwidth}}for(var i=0,len=cm.getColumnCount();i<len;i++){p.id=cm.getColumnId(i);p.value=cm.getColumnHeader(i)||"";p.style=this.getColumnStyle(i,true);if(cm.config[i].align=="right"){p.istyle="padding-right:16px"}cb[cb.length]=ct.apply(p);if(cm.config[i].mtext){var _borderBottom="border-bottom:1px solid #d0d0d0;";if(cm.config[i].mcol==1){_borderBottom=""}var _mwidth=cm.config[i].mwidth;if(_mwidth){_mwidth=(_mwidth/_colTotalWidth)*totalWidth}mcb[mcb.length]=ct2.apply({value:cm.config[i].mtext,mcols:cm.config[i].mcol,mwidth:_mwidth,borderBottom:_borderBottom})}}var s=ts.header.apply({cells:cb.join(""),tstyle:"width:"+this.getTotalWidth()+";",mergecells:mcb.join("")});return s}});viewConfig={forceFit:false,templates:{header:new Ext.Template(' <table border="0" cellspacing="0" cellpadding="0">',' <thead> <tr class="x-grid3-hd-row">{mergecells} </tr><tr class="x-grid3-hd-row">{cells} </tr> </thead>'," </table>"),mhcell:new Ext.Template(' <td class="x-grid3-header" colspan="{mcols}" style="width:{mwidth}px;font-weight:bold;height:35px;{borderBottom}font-size:14px;background:#dfe8f6"> <div align="center">{value}</div>'," </td>")}};Ext.namespace("Ext.whaty.ux.panel.*");Ext.whaty.ux.panel.WhatyPanel=Ext.extend(Ext.Panel,{onRender:function(ct,position){Ext.whaty.ux.panel.WhatyPanel.superclass.onRender.call(this,ct,position);ExtUtil.filterPriority(window._OPT_IDS)}});Ext.whaty.ux.tree.WhatyTreePanel=Ext.extend(Ext.tree.TreePanel,{localmsg:{msgTitle:"Message",setStaticDataText:"Please Set staticData Property",setProxyUrlText:"Please Set proxyUrl Property",rootText:"Root"},allowSearch:false,allowExpand:false,rootAttr:null,autoScroll:true,baseAttrs:null,treeType:"dync",proxyUrl:null,localData:null,baseParam:null,treeLoader:null,initComponent:function(){this._init();if(this.allowSearch||this.allowExpand){this.tbar=this._initToolBar()}Ext.whaty.ux.tree.WhatyTreePanel.superclass.initComponent.call(this)},_init:function(){if(this.treeType=="static"){if(this.localData==null||this.localData==undefined){Ext.Msg.alert(this.localmsg.msgTitle,this.localmsg.setStaticDataText);return}this.loadStaticData(this.root,this.localData)}if(this.treeType=="dync"){if(this.proxyUrl==null||this.proxyUrl==undefined){Ext.Msg.alert(this.localmsg.msgTitle,this.localmsg.setProxyUrlText);return}if(this.root==null||this.root==undefined){var attr={id:"0",text:this.localmsg.rootText,expanded:true};if(this.rootAttr==null){this.rootAttr=new Object()}Ext.applyIf(this.rootAttr,attr);this.root=new Ext.tree.AsyncTreeNode(this.rootAttr);if(this.treeLoader==null||this.treeLoader==undefined){this.loader=new Ext.whaty.ux.tree.WhatyTreeLoader({dataUrl:this.proxyUrl})}this.loader.on("beforeload",this.beforeLoad,this)}}if(this.root==null||this.root==undefined){this.root=new Ext.tree.TreeNode({text:this.localmsg.rootText})}},_initToolBar:function(){var _bar=[];if(this.allowSearch){this.searchInput=new Ext.form.TextField({hideLabel:true});this.searchBtn=new Ext.Button({iconCls:"query",tooltip:this.localmsg.searchBtnText,listeners:{scope:this,click:this._doSearch}});this.treeFilter=new Ext.tree.TreeFilter(this,{clearBlank:true,autoClear:true});this.keys=[{key:Ext.EventObject.ENTER,fn:this._doSearch,scope:this}];_bar.push(this.searchInput);_bar.push(this.searchBtn)}if(this.allowExpand){_bar.push("->");this.expandBtn=new Ext.Button({iconCls:"expand-all",myValue:"expand",tooltip:this.localmsg.expandTooltipText,scope:this,handler:this._doExpandCollapse});_bar.push(this.expandBtn)}if(this.toolbar!=null&&this.toolbar.length>0){for(var i=0;i<this.toolbar.length;i++){_bar.push(this.toolbar[i])}}return _bar},_doExpandCollapse:function(btn){if(btn.myValue=="expand"){btn.setIconClass("collapse-all");this.expandAll();btn.myValue="collapse";btn.setTooltip(this.localmsg.collapseTooltipText)}else{btn.setIconClass("expand-all");this.collapseAll();btn.myValue="expand";btn.setTooltip(this.localmsg.expandTooltipText)}},_doSearch:function(){var text=this.searchInput.getValue();if(!ExtUtil.isEmpty(text)){var re=new RegExp(Ext.escapeRe(text),"i");this.treeFilter.filterBy(function(n){return !n.isLeaf()||re.test(n.text)});this.expandAll()}else{this.treeFilter.clear()}},beforeLoad:function(loader,node){loader.baseParams.nodeId=node.id},loadStaticData:function(parentNode,data){if(this.root==null||this.root==undefined){if(this.baseAttrs){Ext.applyIf(data,this.baseAttrs)}this.root=new Ext.tree.TreeNode(data);this.root.expanded=true;this.createStaticTree(this.root,data.children)}},createStaticTree:function(parentNode,children){if(children!=null&&children!=undefined&&children.length>0){for(var i=0;i<children.length;i++){var childAttr=children[i];if(this.baseAttrs){Ext.applyIf(childAttr,this.baseAttrs)}var node=new Ext.tree.TreeNode(childAttr);parentNode.appendChild(node);this.createStaticTree(node,childAttr.children)}}return},reloadStaticData:function(datas){this.localData=datas;this.removeChild(this.root);this.loadStaticData(this.root,this.localData);this.root.expand()},removeChild:function(node){while(node.firstChild){node.removeChild(node.firstChild)}},getNodePath:function(node){var arr=[];if(node!=null&&node!=undefined){var tmpNode=node;arr.unshift(tmpNode);var deep=tmpNode.getDepth();for(var i=0;i<deep;i++){arr.unshift(tmpNode.parentNode);tmpNode=tmpNode.parentNode}}},getNodePathText:function(node,separator){if(separator==null||separator==undefined){separator=" > "}var arr=[];if(node!=null&&node!=undefined){var tmpNode=node;arr.unshift(tmpNode.text);var deep=tmpNode.getDepth();for(var i=0;i<deep;i++){arr.unshift(tmpNode.parentNode.text);tmpNode=tmpNode.parentNode}}return arr.join(separator)}});Ext.whaty.ux.tree.WhatyTreeLoader=Ext.extend(Ext.tree.TreeLoader,{processResponse:function(response,node,callback,scope){var json=response.responseText;try{if(response.responseJSON==undefined){response.responseJSON=Ext.util.JSON.decode(response.responseText)}var o=response.responseJSON.root||Ext.decode(json);node.beginUpdate();for(var i=0,len=o.length;i<len;i++){var n=this.createNode(o[i]);if(n){node.appendChild(n)}}node.endUpdate();this.runCallback(callback,scope||node,[node])}catch(e){this.handleFailure(response)}}});Ext.namespace("Ext.whaty.ux.window.*");Ext.namespace("Ext.whaty.ux.window.*");Ext.whaty.ux.window.BaseWindow=Ext.extend(Ext.Window,{localmsg:{saveText:"Save",resetText:"Reset",cancelText:"Cancel"},width:600,height:400,allowSave:true,allowReset:false,allowCancel:true,frame:true,autoScroll:true,buttonAlign:"center",btns:[],initComponent:function(){this.buttons=this._initButtons();Ext.whaty.ux.window.BaseWindow.superclass.initComponent.call(this);this.on("hide",this._executeHide,this);this.addEvents("saveWindow","resetWindow")},_initButtons:function(){var _btns=[];if(this.allowSave){this.saveBtn=new Ext.Button({text:this.localmsg.saveText,iconCls:"save",listeners:{scope:this,click:this.doBaseWindowSave}});_btns.push(this.saveBtn)}if(this.allowReset){this.resetBtn=new Ext.Button({text:this.localmsg.resetText,iconCls:"reset",listeners:{scope:this,click:this.doBaseWindowReset}});_btns.push(this.resetBtn)}if(this.allowCancel){this.cancelBtn=new Ext.Button({text:this.localmsg.cancelText,iconCls:"cancel",listeners:{scope:this,click:this.doBaseWindowCancel}});_btns.push(this.cancelBtn)}if(this.btns!=undefined&&this.btns!=null&&this.btns.length>0){for(var i=0;i<this.btns.length;i++){_btns.push(this.btns[i])}}return _btns},doBaseWindowSave:function(){this.fireEvent("saveWindow",this);this.onWindowSave()},onWindowSave:function(){},doBaseWindowReset:function(){this.fireEvent("resetWindow",this)},doBaseWindowCancel:function(){if(this.closeAction=="hide"){this.hide()}else{this.close()}},_executeHide:function(win){if(this.items!=null&&this.items.length>0){for(var i=0;i<this.items.length;i++){var item=this.items.itemAt(i);if(item.resetForm!=undefined&&item.resetForm!=null){item.resetForm()}}}}});Ext.whaty.ux.window.FormWindow=Ext.extend(Ext.whaty.ux.window.BaseWindow,{closeAction:"hide",modal:true,layout:"border",initComponent:function(){if(this.items!=null&&this.items.length>0){var item=this.items[0];item.on("afterSubmit",this.handleAfterSubmit,this)}Ext.whaty.ux.window.FormWindow.superclass.initComponent.call(this);this.addEvents("afterSubmit")},setWindowFormValue:function(object){if(this.items!=null&&this.items.length>0){var item=this.items.itemAt(0);if(item.loadFormValue!=undefined&&item.loadFormValue!=null){item.loadFormValue(object)}}},onWindowSave:function(){if(this.items!=null&&this.items.length>0){var item=this.items.itemAt(0);if(item.submitForm!=undefined&&item.submitForm!=null){item.submitForm()}}},handleAfterSubmit:function(flag){if(flag){this.hide();this.fireEvent("afterSubmit")}}});
/*!
 * Ext JS Library 3.0.0
 * Copyright(c) 2006-2009 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
Ext.ux.Portal=Ext.extend(Ext.Panel,{layout:"column",autoScroll:true,cls:"x-portal",defaultType:"portalcolumn",initComponent:function(){Ext.ux.Portal.superclass.initComponent.call(this);this.addEvents({validatedrop:true,beforedragover:true,dragover:true,beforedrop:true,drop:true})},initEvents:function(){Ext.ux.Portal.superclass.initEvents.call(this);this.dd=new Ext.ux.Portal.DropZone(this,this.dropConfig)},beforeDestroy:function(){if(this.dd){this.dd.unreg()}Ext.ux.Portal.superclass.beforeDestroy.call(this)}});Ext.reg("portal",Ext.ux.Portal);Ext.ux.Portal.DropZone=function(portal,cfg){this.portal=portal;Ext.dd.ScrollManager.register(portal.body);Ext.ux.Portal.DropZone.superclass.constructor.call(this,portal.bwrap.dom,cfg);portal.body.ddScrollConfig=this.ddScrollConfig};Ext.extend(Ext.ux.Portal.DropZone,Ext.dd.DropTarget,{ddScrollConfig:{vthresh:50,hthresh:-1,animate:true,increment:200},createEvent:function(dd,e,data,col,c,pos){return{portal:this.portal,panel:data.panel,columnIndex:col,column:c,position:pos,data:data,source:dd,rawEvent:e,status:this.dropAllowed}},notifyOver:function(dd,e,data){var xy=e.getXY(),portal=this.portal,px=dd.proxy;if(!this.grid){this.grid=this.getGrid()}var cw=portal.body.dom.clientWidth;if(!this.lastCW){this.lastCW=cw}else{if(this.lastCW!=cw){this.lastCW=cw;portal.doLayout();this.grid=this.getGrid()}}var col=0,xs=this.grid.columnX,cmatch=false;for(var len=xs.length;col<len;col++){if(xy[0]<(xs[col].x+xs[col].w)){cmatch=true;break}}if(!cmatch){col--}var p,match=false,pos=0,c=portal.items.itemAt(col),items=c.items.items,overSelf=false;for(var len=items.length;pos<len;pos++){p=items[pos];var h=p.el.getHeight();if(h===0){overSelf=true}else{if((p.el.getY()+(h/2))>xy[1]){match=true;break}}}pos=(match&&p?pos:c.items.getCount())+(overSelf?-1:0);var overEvent=this.createEvent(dd,e,data,col,c,pos);if(portal.fireEvent("validatedrop",overEvent)!==false&&portal.fireEvent("beforedragover",overEvent)!==false){px.getProxy().setWidth("auto");if(p){px.moveProxy(p.el.dom.parentNode,match?p.el.dom:null)}else{px.moveProxy(c.el.dom,null)}this.lastPos={c:c,col:col,p:overSelf||(match&&p)?pos:false};this.scrollPos=portal.body.getScroll();portal.fireEvent("dragover",overEvent);return overEvent.status}else{return overEvent.status}},notifyOut:function(){delete this.grid},notifyDrop:function(dd,e,data){delete this.grid;if(!this.lastPos){return}var c=this.lastPos.c,col=this.lastPos.col,pos=this.lastPos.p;var dropEvent=this.createEvent(dd,e,data,col,c,pos!==false?pos:c.items.getCount());if(this.portal.fireEvent("validatedrop",dropEvent)!==false&&this.portal.fireEvent("beforedrop",dropEvent)!==false){dd.proxy.getProxy().remove();dd.panel.el.dom.parentNode.removeChild(dd.panel.el.dom);if(pos!==false){if(c==dd.panel.ownerCt&&(c.items.items.indexOf(dd.panel)<=pos)){pos++}c.insert(pos,dd.panel)}else{c.add(dd.panel)}c.doLayout();this.portal.fireEvent("drop",dropEvent);var st=this.scrollPos.top;if(st){var d=this.portal.body.dom;setTimeout(function(){d.scrollTop=st},10)}}delete this.lastPos},getGrid:function(){var box=this.portal.bwrap.getBox();box.columnX=[];this.portal.items.each(function(c){box.columnX.push({x:c.el.getX(),w:c.el.getWidth()})});return box},unreg:function(){Ext.ux.Portal.DropZone.superclass.unreg.call(this)}});
/*!
 * Ext JS Library 3.0.0
 */
Ext.ux.PortalColumn=Ext.extend(Ext.Container,{layout:"anchor",defaultType:"portlet",cls:"x-portal-column"});Ext.reg("portalcolumn",Ext.ux.PortalColumn);Ext.ux.Portlet=Ext.extend(Ext.Panel,{anchor:"100%",frame:true,collapsible:true,draggable:true,cls:"x-portlet"});Ext.reg("portlet",Ext.ux.Portlet);Ext.namespace("Ext.ux.Utils");Ext.ux.Utils.EventQueue=function(handler,scope){if(!handler){throw"Handler is required."}this.handler=handler;this.scope=scope||window;this.queue=[];this.is_processing=false;this.postEvent=function(event,data){data=data||null;this.queue.push({event:event,data:data});if(!this.is_processing){this.process()}},this.flushEventQueue=function(){this.queue=[]},this.process=function(){while(this.queue.length>0){this.is_processing=true;var event_data=this.queue.shift();this.handler.call(this.scope,event_data.event,event_data.data)}this.is_processing=false}};Ext.ux.Utils.FSA=function(initial_state,trans_table,trans_table_scope){this.current_state=initial_state;this.trans_table=trans_table||{};this.trans_table_scope=trans_table_scope||window;Ext.ux.Utils.FSA.superclass.constructor.call(this,this.processEvent,this)};Ext.extend(Ext.ux.Utils.FSA,Ext.ux.Utils.EventQueue,{current_state:null,trans_table:null,trans_table_scope:null,state:function(){return this.current_state},processEvent:function(event,data){var transitions=this.currentStateEventTransitions(event);if(!transitions){throw"State '"+this.current_state+"' has no transition for event '"+event+"'."}for(var i=0,len=transitions.length;i<len;i++){var transition=transitions[i];var predicate=transition.predicate||transition.p||true;var action=transition.action||transition.a||Ext.emptyFn;var new_state=transition.state||transition.s||this.current_state;var scope=transition.scope||this.trans_table_scope;if(this.computePredicate(predicate,scope,data,event)){this.callAction(action,scope,data,event);this.current_state=new_state;return}}throw"State '"+this.current_state+"' has no transition for event '"+event+"' in current context"},currentStateEventTransitions:function(event){return this.trans_table[this.current_state]?this.trans_table[this.current_state][event]||false:false},computePredicate:function(predicate,scope,data,event){var result=false;switch(Ext.type(predicate)){case"function":result=predicate.call(scope,data,event,this);break;case"array":result=true;for(var i=0,len=predicate.length;result&&(i<len);i++){if(Ext.type(predicate[i])=="function"){result=predicate[i].call(scope,data,event,this)}else{throw ["Predicate: ",predicate[i],' is not callable in "',this.current_state,'" state for event "',event].join("")}}break;case"boolean":result=predicate;break;default:throw ["Predicate: ",predicate,' is not callable in "',this.current_state,'" state for event "',event].join("")}return result},callAction:function(action,scope,data,event){switch(Ext.type(action)){case"array":for(var i=0,len=action.length;i<len;i++){if(Ext.type(action[i])=="function"){action[i].call(scope,data,event,this)}else{throw ["Action: ",action[i],' is not callable in "',this.current_state,'" state for event "',event].join("")}}break;case"function":action.call(scope,data,event,this);break;default:throw ["Action: ",action,' is not callable in "',this.current_state,'" state for event "',event].join("")}}});Ext.namespace("Ext.ux.UploadDialog");Ext.ux.UploadDialog.BrowseButton=Ext.extend(Ext.Button,{input_name:"file",input_file:null,original_handler:null,original_scope:null,initComponent:function(){Ext.ux.UploadDialog.BrowseButton.superclass.initComponent.call(this);this.original_handler=this.handler||null;this.original_scope=this.scope||window;this.handler=null;this.scope=null},onRender:function(ct,position){Ext.ux.UploadDialog.BrowseButton.superclass.onRender.call(this,ct,position);this.createInputFile()},createInputFile:function(){var button_container=this.el.child("tbody");button_container.position("relative");this.wrap=this.el.wrap({cls:"tbody"});this.input_file=this.wrap.createChild({tag:"input",type:"file",size:1,name:this.input_name||Ext.id(this.el),style:"position: absolute; display: block; border: none; cursor: pointer"});this.input_file.setOpacity(0);var button_box=button_container.getBox();this.input_file.setStyle("font-size",(button_box.width*0.5)+"px");var input_box=this.input_file.getBox();var adj={x:3,y:3};if(Ext.isIE){adj={x:0,y:3}}this.input_file.setLeft(button_box.width-input_box.width+adj.x+"px");this.input_file.setTop(button_box.height-input_box.height+adj.y+"px");this.input_file.setOpacity(0);if(this.handleMouseEvents){this.input_file.on("mouseover",this.onMouseOver,this);this.input_file.on("mousedown",this.onMouseDown,this)}if(this.tooltip){if(typeof this.tooltip=="object"){Ext.QuickTips.register(Ext.apply({target:this.input_file},this.tooltip))}else{this.input_file.dom[this.tooltipType]=this.tooltip}}this.input_file.on("change",this.onInputFileChange,this);this.input_file.on("click",function(e){e.stopPropagation()})},detachInputFile:function(no_create){var result=this.input_file;no_create=no_create||false;if(typeof this.tooltip=="object"){Ext.QuickTips.unregister(this.input_file)}else{this.input_file.dom[this.tooltipType]=null}this.input_file.removeAllListeners();this.input_file=null;if(!no_create){this.createInputFile()}return result},getInputFile:function(){return this.input_file},disable:function(){Ext.ux.UploadDialog.BrowseButton.superclass.disable.call(this);if(null!=this.input_file){this.input_file.dom.disabled=true}},enable:function(){Ext.ux.UploadDialog.BrowseButton.superclass.enable.call(this);this.input_file.dom.disabled=false},destroy:function(){var input_file=this.detachInputFile(true);input_file.remove();input_file=null;Ext.ux.UploadDialog.BrowseButton.superclass.destroy.call(this)},onInputFileChange:function(){if(this.original_handler){this.original_handler.call(this.original_scope,this)}}});Ext.ux.UploadDialog.TBBrowseButton=Ext.extend(Ext.ux.UploadDialog.BrowseButton,{hideParent:true,onDestroy:function(){Ext.ux.UploadDialog.TBBrowseButton.superclass.onDestroy.call(this);if(this.container){this.container.remove()}}});Ext.ux.UploadDialog.FileRecord=Ext.data.Record.create([{name:"id"},{name:"filename"},{name:"state",type:"int"},{name:"note"},{name:"input_element"},{name:"path"}]);Ext.ux.UploadDialog.FileRecord.STATE_QUEUE=0;Ext.ux.UploadDialog.FileRecord.STATE_FINISHED=1;Ext.ux.UploadDialog.FileRecord.STATE_FAILED=2;Ext.ux.UploadDialog.FileRecord.STATE_PROCESSING=3;Ext.ux.UploadDialog.Dialog=function(config){var default_config={border:false,width:450,height:300,minWidth:450,minHeight:300,timeout:1000,plain:true,constrainHeader:true,draggable:true,closable:true,maximizable:false,minimizable:false,resizable:true,layout:"fit",region:"center",autoDestroy:true,closeAction:"close",title:this.i18n.title,cls:"ext-ux-uploaddialog-dialog",uploadUrl:CONTEXT_PATH+"/services/file/FileAction",base_params:{},permitted_extensions:[],reset_on_hide:true,add_on_hide:false,remove_on_hide:false,upload_on_hide:false,allow_close_on_upload:false,upload_autostart:false,Make_Reload:false,post_var_name:"file"};config=Ext.applyIf(config||{},default_config);config.layout="absolute";Ext.ux.UploadDialog.Dialog.superclass.constructor.call(this,config)};Ext.extend(Ext.ux.UploadDialog.Dialog,Ext.Window,{fileIds:[],fsa:null,state_tpl:null,form:null,grid_panel:null,progress_bar:null,is_uploading:false,initial_queued_count:0,upload_frame:null,initComponent:function(){Ext.ux.UploadDialog.Dialog.superclass.initComponent.call(this);this.addEvents("removeAllFiles","removeSuccess");var tt={created:{"window-render":[{action:[this.createForm,this.createProgressBar,this.createGrid],state:"rendering"}],destroy:[{action:this.flushEventQueue,state:"destroyed"}]},rendering:{"grid-render":[{action:[this.fillToolbar,this.updateToolbar],state:"ready"}],destroy:[{action:this.flushEventQueue,state:"destroyed"}]},ready:{"file-selected":[{predicate:[this.fireFileTestEvent,this.isPermittedFile],action:this.addFileToUploadQueue,state:"adding-file"},{}],"grid-selection-change":[{action:this.updateToolbar}],"remove-files":[{action:[this.fireFileRemoveEvent,this.removeFiles]}],"reset-queue":[{action:[this.resetQueue,this.fireResetQueueEvent]}],"start-upload":[{predicate:this.hasUnuploadedFiles,action:[this.setUploadingFlag,this.saveInitialQueuedCount,this.updateToolbar,this.updateProgressBar,this.prepareNextUploadTask,this.fireUploadStartEvent],state:"uploading"},{}],"stop-upload":[{}],hide:[{predicate:[this.isNotEmptyQueue,this.getResetOnHide],action:[this.resetQueue,this.fireResetQueueEvent]},{}],destroy:[{action:this.flushEventQueue,state:"destroyed"}]},"adding-file":{"file-added":[{predicate:this.isUploading,action:[this.incInitialQueuedCount,this.updateProgressBar,this.fireFileAddEvent],state:"uploading"},{predicate:this.getUploadAutostart,action:[this.startUpload,this.fireFileAddEvent],state:"ready"},{action:[this.updateToolbar,this.fireFileAddEvent],state:"ready"}]},uploading:{"file-selected":[{predicate:[this.fireFileTestEvent,this.isPermittedFile],action:this.addFileToUploadQueue,state:"adding-file"},{}],"grid-selection-change":[{}],"start-upload":[{}],"stop-upload":[{predicate:this.hasUnuploadedFiles,action:[this.resetUploadingFlag,this.abortUpload,this.updateToolbar,this.updateProgressBar,this.fireUploadStopEvent],state:"ready"},{action:[this.resetUploadingFlag,this.abortUpload,this.updateToolbar,this.updateProgressBar,this.fireUploadStopEvent,this.fireUploadCompleteEvent],state:"ready"}],"file-upload-start":[{action:[this.uploadFile,this.findUploadFrame,this.fireFileUploadStartEvent]}],"file-upload-success":[{predicate:this.hasUnuploadedFiles,action:[this.resetUploadFrame,this.updateRecordState,this.updateProgressBar,this.prepareNextUploadTask,this.fireUploadSuccessEvent]},{action:[this.resetUploadFrame,this.resetUploadingFlag,this.updateRecordState,this.updateToolbar,this.updateProgressBar,this.fireUploadSuccessEvent,this.fireUploadCompleteEvent],state:"ready"}],"file-upload-error":[{predicate:this.hasUnuploadedFiles,action:[this.resetUploadFrame,this.updateRecordState,this.updateProgressBar,this.prepareNextUploadTask,this.fireUploadErrorEvent]},{action:[this.resetUploadFrame,this.resetUploadingFlag,this.updateRecordState,this.updateToolbar,this.updateProgressBar,this.fireUploadErrorEvent,this.fireUploadCompleteEvent],state:"ready"}],"file-upload-failed":[{predicate:this.hasUnuploadedFiles,action:[this.resetUploadFrame,this.updateRecordState,this.updateProgressBar,this.prepareNextUploadTask,this.fireUploadFailedEvent]},{action:[this.resetUploadFrame,this.resetUploadingFlag,this.updateRecordState,this.updateToolbar,this.updateProgressBar,this.fireUploadFailedEvent,this.fireUploadCompleteEvent],state:"ready"}],hide:[{predicate:this.getResetOnHide,action:[this.stopUpload,this.repostHide]},{}],destroy:[{predicate:this.hasUnuploadedFiles,action:[this.resetUploadingFlag,this.abortUpload,this.fireUploadStopEvent,this.flushEventQueue],state:"destroyed"},{action:[this.resetUploadingFlag,this.abortUpload,this.fireUploadStopEvent,this.fireUploadCompleteEvent,this.flushEventQueue],state:"destroyed"}]},destroyed:{}};this.fsa=new Ext.ux.Utils.FSA("created",tt,this);this.addEvents({filetest:true,fileadd:true,fileremove:true,resetqueue:true,uploadsuccess:true,uploaderror:true,uploadfailed:true,uploadstart:true,uploadstop:true,uploadcomplete:true,fileuploadstart:true});this.on("render",this.onWindowRender,this);this.on("beforehide",this.onWindowBeforeHide,this);this.on("hide",this.onWindowHide,this);this.on("destroy",this.onWindowDestroy,this);this.state_tpl=new Ext.Template("<div class='ext-ux-uploaddialog-state ext-ux-uploaddialog-state-{state}'> </div>").compile()},createForm:function(){this.form=Ext.DomHelper.append(this.body,{tag:"form",method:"post",action:this.uploadUrl+"_doUploadDbFiles.action",style:"position: absolute; left: -100px; top: -100px; width: 100px; height: 100px"})},createProgressBar:function(){this.progress_bar=this.add(new Ext.ProgressBar({x:0,y:0,anchor:"0",value:0,text:this.i18n.progress_waiting_text}))},createGrid:function(){var store=new Ext.data.Store({proxy:new Ext.data.MemoryProxy([]),reader:new Ext.data.JsonReader({},Ext.ux.UploadDialog.FileRecord),sortInfo:{field:"state",direction:"DESC"},pruneModifiedRecords:true});var cm=new Ext.grid.ColumnModel([{header:this.i18n.id_col_title,width:this.i18n.id_col_width,resizeable:true,dataIndex:"id",sortable:true,hidden:true,renderer:this.renderIdCell.createDelegate(this)},{header:this.i18n.state_col_title,width:this.i18n.state_col_width,resizable:false,dataIndex:"state",hidden:true,sortable:true,renderer:this.renderStateCell.createDelegate(this)},{header:this.i18n.filename_col_title,width:this.i18n.filename_col_width,dataIndex:"filename",sortable:true,renderer:this.renderFilenameCell.createDelegate(this)},{header:this.i18n.note_col_title,width:this.i18n.note_col_width,dataIndex:"note",sortable:true,renderer:this.renderNoteCell.createDelegate(this)}]);this.grid_panel=new Ext.grid.GridPanel({ds:store,cm:cm,layout:"fit",height:this.height-50,region:"center",x:0,y:22,url:this.uploadUrl+"_doDownloadDbFiles.action",border:true,viewConfig:{autoFill:true,forceFit:true},bbar:new Ext.Toolbar()});this.grid_panel.on("rowdblclick",this.gridPanelDbClick);this.grid_panel.on("render",this.onGridRender,this);this.add(this.grid_panel);this.grid_panel.getSelectionModel().on("selectionchange",this.onGridSelectionChange,this)},fillToolbar:function(){var tb=this.grid_panel.getBottomToolbar();tb.x_buttons={};tb.x_buttons.add=tb.addItem(new Ext.ux.UploadDialog.TBBrowseButton({input_name:this.post_var_name,text:this.i18n.add_btn_text,tooltip:this.i18n.add_btn_tip,iconCls:"ext-ux-uploaddialog-addbtn",handler:this.onAddButtonFileSelected,scope:this}));tb.x_buttons.remove=tb.addButton({text:this.i18n.remove_btn_text,tooltip:this.i18n.remove_btn_tip,iconCls:"delete",handler:this.onRemoveButtonClick,scope:this});tb.x_buttons.upload=tb.addButton({text:this.i18n.upload_btn_start_text,tooltip:this.i18n.upload_btn_start_tip,iconCls:"ext-ux-uploaddialog-uploadstartbtn",handler:this.onUploadButtonClick,scope:this});tb.add("->");tb.x_buttons.reset=tb.addButton({text:this.i18n.reset_btn_text,tooltip:this.i18n.reset_btn_tip,iconCls:"reset",handler:this.onResetButtonClick,scope:this});tb.add("-");tb.x_buttons.close=tb.addButton({text:this.i18n.close_btn_text,tooltip:this.i18n.close_btn_tip,handler:this.onCloseButtonClick,iconCls:"cancel",scope:this});this.setTbButtonsAble()},renderIdCell:function(data,cell,record,row_index,column_index,store){return data},renderStateCell:function(data,cell,record,row_index,column_index,store){return this.state_tpl.apply({state:data})},renderFilenameCell:function(data,cell,record,row_index,column_index,store){var view=this.grid_panel.getView();var f=function(){try{Ext.fly(view.getCell(row_index,column_index)).child(".x-grid3-cell-inner").dom.qtip=data}catch(e){}};f.defer(1000);if(!Ext.isEmpty(record.get("id"))){var gridId=this.grid_panel.getId();data='<a href="#" onclick="_handleFileDownClick(\''+gridId+"')\">"+data+"</a>"}return data},renderNoteCell:function(data,cell,record,row_index,column_index,store){var view=this.grid_panel.getView();var f=function(){try{Ext.fly(view.getCell(row_index,column_index)).child(".x-grid3-cell-inner").dom.qtip=data}catch(e){}};f.defer(1000);return data},getFileExtension:function(filename){var result=null;var parts=filename.split(".");if(parts.length>1){result=parts.pop()}return result},isPermittedFileType:function(filename){var result=true;if(this.permitted_extensions.length>0){result=this.permitted_extensions.indexOf(this.getFileExtension(filename))!=-1}return result},isPermittedFile:function(browse_btn){var result=false;var filename=browse_btn.getInputFile().dom.value;if(this.isPermittedFileType(filename)){result=true}else{Ext.Msg.alert(this.i18n.error_msgbox_title,String.format(this.i18n.err_file_type_not_permitted,filename,this.permitted_extensions.join(this.i18n.permitted_extensions_join_str)));result=false}return result},fireFileTestEvent:function(browse_btn){return this.fireEvent("filetest",this,browse_btn.getInputFile().dom.value)!==false},addFileToUploadQueue:function(browse_btn){var input_file=browse_btn.detachInputFile();input_file.appendTo(this.form);input_file.setStyle("width","100px");input_file.dom.disabled=true;var store=this.grid_panel.getStore();store.add(new Ext.ux.UploadDialog.FileRecord({id:"",state:Ext.ux.UploadDialog.FileRecord.STATE_QUEUE,filename:input_file.dom.value,note:this.i18n.note_queued_to_upload,input_element:input_file}));this.fsa.postEvent("file-added",input_file.dom.value)},fireFileAddEvent:function(filename){this.fireEvent("fileadd",this,filename)},updateProgressBar:function(){if(this.is_uploading){var queued=this.getQueuedCount(true);var value=1-queued/this.initial_queued_count;this.progress_bar.updateProgress(value,String.format(this.i18n.progress_uploading_text,this.initial_queued_count-queued,this.initial_queued_count))}else{this.progress_bar.updateProgress(0,this.i18n.progress_waiting_text)}},updateToolbar:function(){var tb=this.grid_panel.getBottomToolbar();if(this.is_uploading){tb.x_buttons.remove.disable();tb.x_buttons.upload.enable();if(!this.getAllowCloseOnUpload()){tb.x_buttons.close.disable()}tb.x_buttons.upload.setIconClass("ext-ux-uploaddialog-uploadstopbtn");tb.x_buttons.upload.setText(this.i18n.upload_btn_stop_text);tb.x_buttons.upload.getEl().child(tb.x_buttons.upload.buttonSelector).dom[tb.x_buttons.upload.tooltipType]=this.i18n.upload_btn_stop_tip}else{tb.x_buttons.remove.enable();tb.x_buttons.close.enable();tb.x_buttons.upload.setIconClass("ext-ux-uploaddialog-uploadstartbtn");tb.x_buttons.upload.setText(this.i18n.upload_btn_start_text);if(this.getQueuedCount()>0){tb.x_buttons.upload.enable()}else{tb.x_buttons.upload.disable()}if(this.grid_panel.getSelectionModel().hasSelection()){tb.x_buttons.remove.enable()}else{tb.x_buttons.remove.disable()}}this.setTbButtonsAble()},setTbButtonsAble:function(){var tb=this.grid_panel.getBottomToolbar();if(this.getAddOnHide()){tb.x_buttons.add.disable()}if(this.getRemoveOnHide()){tb.x_buttons.remove.disable()}if(this.getUploadOnHide()){tb.x_buttons.upload.disable()}if(this.getResetOnHide()){tb.x_buttons.reset.disable()}},saveInitialQueuedCount:function(){this.initial_queued_count=this.getQueuedCount()},incInitialQueuedCount:function(){this.initial_queued_count++},setUploadingFlag:function(){this.is_uploading=true},resetUploadingFlag:function(){this.is_uploading=false},prepareNextUploadTask:function(){var store=this.grid_panel.getStore();var record=null;store.each(function(r){if(!record&&r.get("state")==Ext.ux.UploadDialog.FileRecord.STATE_QUEUE){record=r}else{r.get("input_element").dom.disabled=true}});record.get("input_element").dom.disabled=false;record.set("state",Ext.ux.UploadDialog.FileRecord.STATE_PROCESSING);record.set("note",this.i18n.note_processing);record.set("id","");record.commit();this.fsa.postEvent("file-upload-start",record)},fireUploadStartEvent:function(){this.fireEvent("uploadstart",this)},removeFiles:function(file_records){var fileIdArray=[];var store=this.grid_panel.getStore();for(var i=0,len=file_records.length;i<len;i++){var r=file_records[i];if(!ExtUtil.isEmpty(r.get("id"))){fileIdArray.push(r.get("id"))}r.get("input_element").remove();store.remove(r)}if(fileIdArray.length!=0){this.deleteFile(file_records,fileIdArray.join(","))}if(!this.hasUploadedFile(this.grid_panel)){this.fireEvent("removeAllFiles")}},fireFileRemoveEvent:function(file_records){for(var i=0,len=file_records.length;i<len;i++){this.fireEvent("fileremove",this,file_records[i].get("filename"))}},resetQueue:function(){var store=this.grid_panel.getStore();store.each(function(r){if(ExtUtil.isEmpty(r.get("id"))){r.get("input_element").remove();store.remove(r)}})},fireResetQueueEvent:function(){this.fireEvent("resetqueue",this)},deleteFile:function(records,ids){this.setBaseParams(Ext.apply(this.base_params,{fileIds:ids}));Ext.Ajax.request({url:this.uploadUrl+"_doDeleteDbFiles.action",params:this.base_params||this.base_Params||this.params,method:"POST",success:this.onDeleteSuccess,failure:this.onDeleteFailure,scope:this,record:records})},uploadFile:function(record){Ext.Ajax.request({url:this.uploadUrl+"_doUploadDbFiles.action",params:this.base_params||this.baseParams||this.params,method:"POST",form:this.form,isUpload:true,success:this.onUploadSuccess,failure:this.onUploadFailure,scope:this,record:record})},fireFileUploadStartEvent:function(record){this.fireEvent("fileuploadstart",this,record.get("filename"))},updateRecordState:function(data){if("success" in data.response&&data.response.success){data.record.set("state",Ext.ux.UploadDialog.FileRecord.STATE_FINISHED);data.record.set("note",data.response.message||data.response.error||this.i18n.note_upload_success)}else{data.record.set("state",Ext.ux.UploadDialog.FileRecord.STATE_FAILED);data.record.set("note",data.response.message||data.response.error||this.i18n.note_upload_error)}data.record.commit()},fireUploadSuccessEvent:function(data){this.fireEvent("uploadsuccess",this,data.record.get("filename"),data.response,data.record)},fireUploadErrorEvent:function(data){this.fireEvent("uploaderror",this,data.record.get("filename"),data.response)},fireUploadFailedEvent:function(data){this.fireEvent("uploadfailed",this,data.record.get("filename"))},fireUploadCompleteEvent:function(){this.fireEvent("uploadcomplete",this)},findUploadFrame:function(){this.upload_frame=Ext.getBody().child("iframe.x-hidden:last")},resetUploadFrame:function(){this.upload_frame=null},removeUploadFrame:function(){if(this.upload_frame){this.upload_frame.removeAllListeners();this.upload_frame.dom.src="about:blank";this.upload_frame.remove()}this.upload_frame=null},abortUpload:function(){this.removeUploadFrame();var store=this.grid_panel.getStore();var record=null;store.each(function(r){if(r.get("state")==Ext.ux.UploadDialog.FileRecord.STATE_PROCESSING){record=r;return false}});record.set("state",Ext.ux.UploadDialog.FileRecord.STATE_FAILED);record.set("note",this.i18n.note_aborted);record.commit()},fireUploadStopEvent:function(){this.fireEvent("uploadstop",this)},repostHide:function(){this.fsa.postEvent("hide")},flushEventQueue:function(){this.fsa.flushEventQueue()},onWindowRender:function(){this.fsa.postEvent("window-render")},onWindowBeforeHide:function(){return this.isUploading()?this.getAllowCloseOnUpload():true},onWindowHide:function(){this.fsa.postEvent("hide")},onWindowDestroy:function(){this.fsa.postEvent("destroy")},onGridRender:function(){this.fsa.postEvent("grid-render")},onGridSelectionChange:function(){this.fsa.postEvent("grid-selection-change")},onAddButtonFileSelected:function(btn){if(!this.getAddOnHide()){this.fsa.postEvent("file-selected",btn)}},onUploadButtonClick:function(){if(!this.getUploadOnHide()){if(this.is_uploading){this.fsa.postEvent("stop-upload")}else{this.fsa.postEvent("start-upload")}}},onRemoveButtonClick:function(){if(!this.getRemoveOnHide()){var selections=this.grid_panel.getSelectionModel().getSelections();this.fsa.postEvent("remove-files",selections)}},onResetButtonClick:function(){this.fsa.postEvent("reset-queue")},onCloseButtonClick:function(){this[this.closeAction].call(this);if(this.Make_Reload==true){document.location.reload()}},onUploadSuccess:function(response,options){var json_response={success:false,error:this.i18n.note_upload_error};try{var rt=response.responseText;var filter=rt.match(/^<pre>((?:.|\n)*)<\/pre>$/i);if(filter){rt=filter[1]}json_response=Ext.util.JSON.decode(rt)}catch(e){}var data={record:options.record,response:json_response};this.fileIds.push(json_response.fileIds);if("success" in json_response&&json_response.success){options.record.set("id",json_response.files.root[0].id);options.record.set("filename",json_response.files.root[0].name);options.record.set("path",json_response.files.root[0].path);options.record.commit();this.fsa.postEvent("file-upload-success",data)}else{this.fsa.postEvent("file-upload-error",data)}},onUploadFailure:function(response,options){var data={record:options.record,response:{success:false,error:this.i18n.note_upload_failed}};this.fsa.postEvent("file-upload-failed",data)},onDeleteSuccess:function(response,options){this.fireEvent("removeSuccess",response,options);ExtUtil.alert(this.i18n.msgTitle,this.i18n.msg_delete_success,this.timeout)},onDeleteFailure:function(response,options){ExtUtil.alert(this.i18n.msgTitle,this.i18n.msg_delete_failed,this.timeout)},onViewSuccess:function(response,options){var browse_btn=this.grid_panel.getBottomToolbar().x_buttons.add;var input_file=browse_btn.detachInputFile();input_file.appendTo(this.form);input_file.setStyle("width","100px");input_file.dom.disabled=true;var json_response={id:"",filename:"",path:""};try{var rt=response.responseText;var filter=rt.match(/^<pre>((?:.|\n)*)<\/pre>$/i);if(filter){rt=filter[1]}json_response=Ext.util.JSON.decode(rt)}catch(e){}var store=this.grid_panel.getStore();store.removeAll();if(json_response.root!=undefined){for(var i=0;i<json_response.root.length;i++){var record=new Ext.ux.UploadDialog.FileRecord({id:json_response.root[i].id,state:Ext.ux.UploadDialog.FileRecord.STATE_FINISHED,filename:json_response.root[i].name,note:this.i18n.note_upload_success,input_element:input_file,path:json_response.root[i].path});store.add(record);this.fileIds.push(json_response.root[i].id);var data={record:record,response:json_response}}}},onViewFailure:function(response,options){},hasUploadedFile:function(grid){var store=grid.getStore();var has=false;store.each(function(r){if(!ExtUtil.isEmpty(r.get("id"))){if(!has){has=true}}});return has},startUpload:function(){this.fsa.postEvent("start-upload")},stopUpload:function(){this.fsa.postEvent("stop-upload")},getUploadUrl:function(){return this.uploadUrl},setUploadUrl:function(uploadUrl){this.uploadUrl=uploadUrl},getBaseParams:function(){return this.base_params},setBaseParams:function(params){this.base_params=params},getUploadAutostart:function(){return this.upload_autostart},setUploadAutostart:function(value){this.upload_autostart=value},getMakeReload:function(){return this.Make_Reload},setMakeReload:function(value){this.Make_Reload=value},getAllowCloseOnUpload:function(){return this.allow_close_on_upload},setAllowCloseOnUpload:function(value){this.allow_close_on_upload},getResetOnHide:function(){return this.reset_on_hide},setResetOnHide:function(value){this.reset_on_hide=value},getAddOnHide:function(){return this.add_on_hide},setAddOnHide:function(value){this.add_on_hide=value},getRemoveOnHide:function(){return this.remove_on_hide},setRemoveOnHide:function(value){this.remove_on_hide=value},getUploadOnHide:function(){return this.upload_on_hide},setUploadOnHide:function(value){this.upload_on_hide=value},getPermittedExtensions:function(){return this.permitted_extensions},setPermittedExtensions:function(value){this.permitted_extensions=value},isUploading:function(){return this.is_uploading},isNotEmptyQueue:function(){return this.grid_panel.getStore().getCount()>0},getQueuedCount:function(count_processing){var count=0;var store=this.grid_panel.getStore();store.each(function(r){if(r.get("state")==Ext.ux.UploadDialog.FileRecord.STATE_QUEUE){count++}if(count_processing&&r.get("state")==Ext.ux.UploadDialog.FileRecord.STATE_PROCESSING){count++}});return count},hasUnuploadedFiles:function(){return this.getQueuedCount()>0},gridPanelDbClick:function(grid,rowIndex,event){var record=grid.getSelectionModel().getSelected();if(!Ext.fly("downloadAttachFileForm")){var frm=document.createElement("form");frm.id="downloadAttachFileForm";frm.style.display="none";document.body.appendChild(frm)}Ext.Ajax.request({url:this.url,params:{fileIds:record.get("id")},form:Ext.fly("downloadAttachFileForm"),method:"POST",isUpload:true,success:function(response,options){},failure:function(response,options){ExtUtil.alert(this.i18n.msgTitle,this.i18n.msg_download_failed,this.timeout)},scope:this})},showDialog:function(){this.show();Ext.Ajax.request({url:this.uploadUrl+"_doViewDbFiles.action",params:this.base_params||this.baseParams||this.params,method:"POST",form:this.form,success:this.onViewSuccess,failure:this.onViewFailure,scope:this})}});function _handleFileDownClick(id){var grid=Ext.getCmp(id);grid.fireEvent("rowdblclick",grid)}var p=Ext.ux.UploadDialog.Dialog.prototype;p.i18n={title:"File upload dialog a",id_col_title:"id",id_col_width:150,state_col_title:"State",state_col_width:70,filename_col_title:"Filename",filename_col_width:230,note_col_title:"Note",note_col_width:150,add_btn_text:"Add",add_btn_tip:"Add file into upload queue.",remove_btn_text:"Remove",remove_btn_tip:"Remove file from upload queue.",reset_btn_text:"Reset",reset_btn_tip:"Reset queue.",upload_btn_start_text:"Upload",upload_btn_stop_text:"Abort",upload_btn_start_tip:"Upload queued files to the server.",upload_btn_stop_tip:"Stop upload.",close_btn_text:"Close",close_btn_tip:"Close the dialog.",progress_waiting_text:"Waiting...",progress_uploading_text:"Uploading: {0} of {1} files complete.",error_msgbox_title:"Error",permitted_extensions_join_str:",",err_file_type_not_permitted:"Selected file extension isn't permitted.<br/>Please select files with following extensions: {1}",note_queued_to_upload:"Queued for upload.",note_processing:"Uploading...",note_upload_failed:"Server is unavailable or internal server error occured.",note_upload_success:"OK.",note_upload_error:"Upload error.",note_aborted:"Aborted by user.",msgTitle:"Message",msg_delete_success:"file delete success.",msg_delete_failed:"file delete failed.",msg_download_failed:"file download failed."};